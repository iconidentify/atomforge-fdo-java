package com.atomforge.fdo.dsl;

import com.atomforge.fdo.FdoCompiler;
import com.atomforge.fdo.FdoException;
import com.atomforge.fdo.dsl.atoms.*;
import com.atomforge.fdo.dsl.internal.DslAtomFrame;
import com.atomforge.fdo.dsl.internal.DslTextEmitter;
import com.atomforge.fdo.dsl.values.*;
import com.atomforge.fdo.model.FdoGid;

import java.util.ArrayList;
import java.util.List;
import java.util.function.Consumer;

/**
 * Fluent builder for constructing FDO streams.
 *
 * This is the primary interface for programmatically building FDO scripts
 * with type-safe atom references and value enums.
 *
 * Example usage:
 * <pre>{@code
 * byte[] binary = FdoScript.stream()
 *     .startObject(ObjectType.IND_GROUP, "Login Window")
 *         .orientation(Orientation.VCF)
 *         .position(Position.CENTER_CENTER)
 *     .endObject()
 *     .compile();
 * }</pre>
 */
public final class StreamBuilder {

    private final List<DslAtomFrame> frames = new ArrayList<>();
    private final StreamBuilder parent;

    /**
     * Create a new root stream builder.
     */
    StreamBuilder() {
        this.parent = null;
    }

    /**
     * Create a nested stream builder.
     */
    private StreamBuilder(StreamBuilder parent) {
        this.parent = parent;
    }

    // ========== Core atom methods ==========

    /**
     * Add a raw atom with the given arguments.
     *
     * <p>For atoms with typed arguments, consider using the type-safe methods instead:
     * {@link #actSetCriterion(Criterion)}, {@link #matOrientation(Orientation)}, etc.
     *
     * @param atom The atom to add
     * @param args The arguments for the atom
     * @return this builder for chaining
     */
    public StreamBuilder atom(DslAtom atom, Object... args) {
        frames.add(new DslAtomFrame(atom, args));
        return this;
    }

    /**
     * Add an atom with a nested stream (lambda style).
     *
     * This enables the code pattern generated by DslCodeGenerator:
     * <pre>{@code
     * .atom(ActAtom.REPLACE_SELECT_ACTION, nested -> {
     *     nested.atom(UniAtom.START_STREAM, "00x");
     *     nested.atom(SmAtom.SEND_TOKEN_ARG, "LP");
     * })
     * }</pre>
     *
     * @param atom The atom to add
     * @param nestedStreamBuilder Consumer that builds the nested stream
     * @return this builder for chaining
     */
    public StreamBuilder atom(DslAtom atom, Consumer<StreamBuilder> nestedStreamBuilder) {
        StreamBuilder nested = new StreamBuilder(this);
        nestedStreamBuilder.accept(nested);
        DslAtomFrame frame = new DslAtomFrame(atom);
        frame.withNestedStream(nested.frames);
        frames.add(frame);
        return this;
    }

    /**
     * Add an atom with arguments followed by a nested stream (lambda style).
     *
     * This enables patterns like:
     * <pre>{@code
     * .atom(UniAtom.USE_LAST_ATOM_STRING, nested -> {
     *     nested.atom(MatAtom.TITLE);
     * })
     * }</pre>
     *
     * @param atom The atom to add
     * @param arg1 First argument
     * @param nestedStreamBuilder Consumer that builds the nested stream
     * @return this builder for chaining
     */
    public StreamBuilder atom(DslAtom atom, Object arg1, Consumer<StreamBuilder> nestedStreamBuilder) {
        StreamBuilder nested = new StreamBuilder(this);
        nestedStreamBuilder.accept(nested);
        DslAtomFrame frame = new DslAtomFrame(atom, arg1);
        frame.withNestedStream(nested.frames);
        frames.add(frame);
        return this;
    }

    /**
     * Add an atom with two arguments followed by a nested stream (lambda style).
     *
     * @param atom The atom to add
     * @param arg1 First argument
     * @param arg2 Second argument
     * @param nestedStreamBuilder Consumer that builds the nested stream
     * @return this builder for chaining
     */
    public StreamBuilder atom(DslAtom atom, Object arg1, Object arg2, Consumer<StreamBuilder> nestedStreamBuilder) {
        StreamBuilder nested = new StreamBuilder(this);
        nestedStreamBuilder.accept(nested);
        DslAtomFrame frame = new DslAtomFrame(atom, arg1, arg2);
        frame.withNestedStream(nested.frames);
        frames.add(frame);
        return this;
    }

    /**
     * Add a UNI protocol atom.
     */
    public StreamBuilder uni(UniAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add a MAN protocol atom.
     */
    public StreamBuilder man(ManAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add an ACT protocol atom.
     */
    public StreamBuilder act(ActAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add a DE protocol atom.
     */
    public StreamBuilder de(DeAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add a MAT protocol atom.
     */
    public StreamBuilder mat(MatAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add an IF protocol atom.
     */
    public StreamBuilder if_(IfAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add a VAR protocol atom.
     */
    public StreamBuilder var(VarAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Add an IDB protocol atom.
     */
    public StreamBuilder idb(IdbAtom atom, Object... args) {
        return atom(atom, args);
    }

    // ========== Convenience methods ==========

    /**
     * Add de_data with a string value.
     */
    public StreamBuilder data(String value) {
        return atom(DeAtom.DATA, value);
    }

    /**
     * Add de_data with a GID value.
     */
    public StreamBuilder data(FdoGid gid) {
        return atom(DeAtom.DATA, gid.toString());
    }

    /**
     * Add de_data with a number value.
     */
    public StreamBuilder data(long value) {
        return atom(DeAtom.DATA, String.valueOf(value));
    }

    /**
     * Add mat_orientation with orientation enum.
     */
    public StreamBuilder orientation(Orientation orient) {
        return atom(MatAtom.ORIENTATION, orient);
    }

    /**
     * Add mat_position with position enum.
     */
    public StreamBuilder position(Position pos) {
        return atom(MatAtom.POSITION, pos);
    }

    /**
     * Add mat_title_pos with title position enum.
     */
    public StreamBuilder titlePos(TitlePosition pos) {
        return atom(MatAtom.TITLE_POS, pos);
    }

    /**
     * Add mat_font_id with font enum.
     */
    public StreamBuilder fontId(FontId font) {
        return atom(MatAtom.FONT_ID, font);
    }

    /**
     * Add mat_font_size with size value.
     */
    public StreamBuilder fontSize(int size) {
        return atom(MatAtom.FONT_SIZE, size);
    }

    /**
     * Add mat_font_style with style enum.
     */
    public StreamBuilder fontStyle(FontStyle style) {
        return atom(MatAtom.FONT_STYLE, style);
    }

    /**
     * Add mat_font_sis (font id, size, style combo).
     */
    public StreamBuilder fontSis(FontId font, int size, FontStyle style) {
        return atom(MatAtom.FONT_SIS, font.code(), size, style.code());
    }

    /**
     * Add mat_frame_style with style enum.
     */
    public StreamBuilder frameStyle(FrameStyle style) {
        return atom(MatAtom.FRAME_STYLE, (style.code() >> 8) & 0xFF, style.code() & 0xFF);
    }

    /**
     * Add mat_trigger_style with style enum.
     */
    public StreamBuilder triggerStyle(TriggerStyle style) {
        return atom(MatAtom.TRIGGER_STYLE, (style.code() >> 8) & 0xFF, style.code() & 0xFF);
    }

    /**
     * Add mat_size with dimensions.
     */
    public StreamBuilder size(int rows, int cols) {
        return atom(MatAtom.SIZE, rows, cols);
    }

    /**
     * Add mat_size with dimensions and max chars.
     */
    public StreamBuilder size(int rows, int cols, int maxChars) {
        return atom(MatAtom.SIZE, rows, cols, maxChars);
    }

    /**
     * Add mat_log_object with log type.
     */
    public StreamBuilder logType(LogType type) {
        return atom(MatAtom.LOG_OBJECT, type);
    }

    /**
     * Add mat_sort_order with order type.
     */
    public StreamBuilder sortOrder(SortOrder order) {
        return atom(MatAtom.SORT_ORDER, order);
    }

    /**
     * Add mat_bool_disabled (boolean attribute).
     */
    public StreamBuilder disabled() {
        return atom(MatAtom.BOOL_DISABLED);
    }

    /**
     * Add mat_bool_invisible (boolean attribute).
     */
    public StreamBuilder invisible() {
        return atom(MatAtom.BOOL_INVISIBLE);
    }

    /**
     * Add mat_bool_modal (boolean attribute).
     */
    public StreamBuilder modal() {
        return atom(MatAtom.BOOL_MODAL);
    }

    // ========== Precise positioning ==========

    /**
     * Enable precise positioning mode (mat_bool_precise).
     */
    public StreamBuilder precise() {
        return atom(MatAtom.BOOL_PRECISE);
    }

    /**
     * Set precise width in pixels (mat_precise_width).
     */
    public StreamBuilder preciseWidth(int width) {
        return atom(MatAtom.PRECISE_WIDTH, width);
    }

    /**
     * Set precise height in pixels (mat_precise_height).
     */
    public StreamBuilder preciseHeight(int height) {
        return atom(MatAtom.PRECISE_HEIGHT, height);
    }

    /**
     * Set precise X position in pixels (mat_precise_x).
     */
    public StreamBuilder preciseX(int x) {
        return atom(MatAtom.PRECISE_X, x);
    }

    /**
     * Set precise Y position in pixels (mat_precise_y).
     */
    public StreamBuilder preciseY(int y) {
        return atom(MatAtom.PRECISE_Y, y);
    }

    /**
     * Set precise bounds (width, height, x, y) in one call.
     */
    public StreamBuilder preciseBounds(int x, int y, int width, int height) {
        return preciseX(x).preciseY(y).preciseWidth(width).preciseHeight(height);
    }

    // ========== Background styling ==========

    /**
     * Enable background tiling (mat_bool_background_tile).
     */
    public StreamBuilder backgroundTile() {
        return atom(MatAtom.BOOL_BACKGROUND_TILE);
    }

    /**
     * Enable background picture (mat_bool_background_pic).
     */
    public StreamBuilder backgroundPic() {
        return atom(MatAtom.BOOL_BACKGROUND_PIC);
    }

    /**
     * Set the art/image ID (mat_art_id).
     */
    public StreamBuilder artId(FdoGid gid) {
        return atom(MatAtom.ART_ID, gid);
    }

    /**
     * Set the art/image ID from components (mat_art_id).
     */
    public StreamBuilder artId(int type, int subtype, int id) {
        return atom(MatAtom.ART_ID, FdoGid.of(type, subtype, id));
    }

    // ========== Title and capacity ==========

    /**
     * Set the window/object title (mat_title).
     */
    public StreamBuilder title(String title) {
        return atom(MatAtom.TITLE, title);
    }

    /**
     * Set the capacity/buffer size (mat_capacity).
     */
    public StreamBuilder capacity(int capacity) {
        return atom(MatAtom.CAPACITY, capacity);
    }

    // ========== Scrolling and edit behavior ==========

    /**
     * Enable vertical scrolling (mat_bool_vertical_scroll).
     */
    public StreamBuilder verticalScroll() {
        return atom(MatAtom.BOOL_VERTICAL_SCROLL);
    }

    /**
     * Enable horizontal scrolling (mat_bool_horizontal_scroll).
     */
    public StreamBuilder horizontalScroll() {
        return atom(MatAtom.BOOL_HORIZONTAL_SCROLL);
    }

    /**
     * Set writeable flag (mat_bool_writeable).
     * @param writeable true to allow writing, false for read-only
     */
    public StreamBuilder writeable(boolean writeable) {
        return atom(MatAtom.BOOL_WRITEABLE, writeable ? 1 : 0);
    }

    // ========== Data operations ==========

    /**
     * Append data to the current object (man_append_data) with string.
     */
    public StreamBuilder appendData(String data) {
        return atom(ManAtom.APPEND_DATA, data);
    }

    /**
     * Append data to the current object (man_append_data) with raw bytes.
     */
    public StreamBuilder appendData(byte[] data) {
        return atom(ManAtom.APPEND_DATA, data);
    }

    /**
     * End data block (man_end_data).
     */
    public StreamBuilder endData() {
        return atom(ManAtom.END_DATA);
    }

    /**
     * Add raw byte data to an atom. Useful for binary payloads.
     */
    public StreamBuilder rawData(DslAtom atomType, byte[] data) {
        return atom(atomType, data);
    }

    // ========== Display operations ==========

    /**
     * Update the display (man_update_display).
     */
    public StreamBuilder updateDisplay() {
        return atom(ManAtom.UPDATE_DISPLAY);
    }

    /**
     * Turn off wait cursor (uni_wait_off).
     */
    public StreamBuilder waitOff() {
        return atom(UniAtom.WAIT_OFF);
    }

    /**
     * Turn on wait cursor (uni_wait_on).
     */
    public StreamBuilder waitOn() {
        return atom(UniAtom.WAIT_ON);
    }

    /**
     * End stream with wait off (uni_wait_off_end_stream).
     */
    public StreamBuilder waitOffEndStream() {
        return atom(UniAtom.WAIT_OFF_END_STREAM);
    }

    /**
     * Start stream with wait on (uni_start_stream_wait_on).
     */
    public StreamBuilder startStreamWaitOn() {
        return atom(UniAtom.START_STREAM_WAIT_ON);
    }

    /**
     * Start a standard stream (uni_start_stream).
     */
    public StreamBuilder startStream() {
        return atom(UniAtom.START_STREAM);
    }

    /**
     * End stream (uni_end_stream).
     */
    public StreamBuilder endStream() {
        return atom(UniAtom.END_STREAM);
    }

    /**
     * Invoke a local form by GID (uni_invoke_local).
     */
    public StreamBuilder invokeLocal(FdoGid gid) {
        return atom(UniAtom.INVOKE_LOCAL, gid);
    }

    /**
     * Invoke a local form by GID components (uni_invoke_local).
     */
    public StreamBuilder invokeLocal(int type, int id) {
        return atom(UniAtom.INVOKE_LOCAL, FdoGid.of(type, id));
    }

    /**
     * Force display update (man_force_update).
     */
    public StreamBuilder forceUpdate() {
        return atom(ManAtom.FORCE_UPDATE);
    }

    /**
     * Make focus on current context (man_make_focus).
     */
    public StreamBuilder makeFocus() {
        return atom(ManAtom.MAKE_FOCUS);
    }

    /**
     * Replace data in current context (man_replace_data).
     */
    public StreamBuilder replaceData(String data) {
        return atom(ManAtom.REPLACE_DATA, data);
    }

    // ========== Context manipulation ==========

    /**
     * Set context relative (man_set_context_relative).
     */
    public StreamBuilder setContextRelative(int offset) {
        return atom(ManAtom.SET_CONTEXT_RELATIVE, offset);
    }

    /**
     * Set context by global ID (man_set_context_globalid).
     */
    public StreamBuilder setContextGlobalId(FdoGid gid) {
        return atom(ManAtom.SET_CONTEXT_GLOBALID, gid);
    }

    /**
     * Set context by global ID components (man_set_context_globalid).
     */
    public StreamBuilder setContextGlobalId(int type, int id) {
        return atom(ManAtom.SET_CONTEXT_GLOBALID, FdoGid.of(type, id));
    }

    /**
     * End context (man_end_context).
     */
    public StreamBuilder endContext() {
        return atom(ManAtom.END_CONTEXT);
    }

    /**
     * Convenience: Execute operations within a relative context.
     * Automatically handles set_context_relative and end_context.
     *
     * @param offset The relative offset to set context to
     * @param contextOps Operations to perform within the context
     * @deprecated Use {@link #context(int, Consumer)} instead for better exception safety.
     */
    @Deprecated
    public StreamBuilder withContextRelative(int offset, Consumer<StreamBuilder> contextOps) {
        setContextRelative(offset);
        contextOps.accept(this);
        return endContext();
    }

    /**
     * Convenience: Execute operations within a global ID context.
     * Automatically handles set_context_globalid and end_context.
     *
     * @param gid The global ID to set context to
     * @param contextOps Operations to perform within the context
     * @deprecated Use {@link #contextGlobalId(FdoGid, Consumer)} instead for better exception safety.
     */
    @Deprecated
    public StreamBuilder withContextGlobalId(FdoGid gid, Consumer<StreamBuilder> contextOps) {
        setContextGlobalId(gid);
        contextOps.accept(this);
        return endContext();
    }

    // ========== Scoped context building (recommended) ==========

    /**
     * Build within a relative context with automatic scoping - no endContext() needed.
     *
     * <p>Emits man_set_context_relative at the start and man_end_context at the end.
     * Example:
     * <pre>{@code
     * stream.context(TAG_USER_LIST, ctx -> {
     *     ctx.data("content");
     * });
     * }</pre>
     *
     * @param offset The relative offset to set context to
     * @param ops Operations to perform within the context
     * @return this builder for chaining
     */
    public StreamBuilder context(int offset, Consumer<StreamBuilder> ops) {
        setContextRelative(offset);
        try {
            ops.accept(this);
        } finally {
            endContext();
        }
        return this;
    }

    /**
     * Build within a global ID context with automatic scoping - no endContext() needed.
     *
     * @param gid The global ID to set context to
     * @param ops Operations to perform within the context
     * @return this builder for chaining
     */
    public StreamBuilder contextGlobalId(FdoGid gid, Consumer<StreamBuilder> ops) {
        setContextGlobalId(gid);
        try {
            ops.accept(this);
        } finally {
            endContext();
        }
        return this;
    }

    // ========== SM (State Machine) protocol ==========

    /**
     * Add an SM protocol atom.
     */
    public StreamBuilder sm(SmAtom atom, Object... args) {
        return atom(atom, args);
    }

    /**
     * Send a token argument (sm_send_token_arg).
     */
    public StreamBuilder sendTokenArg(String token) {
        return atom(SmAtom.SEND_TOKEN_ARG, token);
    }

    /**
     * Send a raw token (sm_send_token_raw).
     */
    public StreamBuilder sendTokenRaw(String token) {
        return atom(SmAtom.SEND_TOKEN_RAW, token);
    }

    // ========== Action replacement ==========

    /**
     * Replace select action with a nested stream (act_replace_select_action).
     *
     * @param actionBuilder Consumer that builds the action stream
     */
    public StreamBuilder replaceSelectAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);

        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_SELECT_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);

        return this;
    }

    /**
     * Replace action with a nested stream (act_replace_action).
     *
     * @param actionBuilder Consumer that builds the action stream
     */
    public StreamBuilder replaceAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);

        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);

        return this;
    }

    // ========== Object building (legacy API - use scoped methods instead) ==========

    /**
     * Start a new object (man_start_object).
     *
     * @param type The object type
     * @return An ObjectBuilder for configuring the object
     * @deprecated Use {@link #object(ObjectType, Consumer)} for automatic scoping instead.
     */
    @Deprecated
    public ObjectBuilder startObject(ObjectType type) {
        return startObject(type, null);
    }

    /**
     * Start a new object with a title.
     *
     * @param type The object type
     * @param title The object title (can be null)
     * @return An ObjectBuilder for configuring the object
     * @deprecated Use {@link #object(ObjectType, String, Consumer)} for automatic scoping instead.
     */
    @Deprecated
    public ObjectBuilder startObject(ObjectType type, String title) {
        DslAtomFrame frame = new DslAtomFrame(ManAtom.START_OBJECT, type, title != null ? title : "");
        frames.add(frame);
        return new ObjectBuilder(this);
    }

    /**
     * Start a sibling object (man_start_sibling).
     *
     * @param type The object type
     * @return An ObjectBuilder for configuring the object
     * @deprecated Use sibling() within an object() lambda instead.
     */
    @Deprecated
    public ObjectBuilder startSibling(ObjectType type) {
        return startSibling(type, null);
    }

    /**
     * Start a sibling object with a title.
     *
     * @param type The object type
     * @param title The object title (can be null)
     * @return An ObjectBuilder for configuring the object
     * @deprecated Use sibling() within an object() lambda instead.
     */
    @Deprecated
    public ObjectBuilder startSibling(ObjectType type, String title) {
        DslAtomFrame frame = new DslAtomFrame(ManAtom.START_SIBLING, type, title != null ? title : "");
        frames.add(frame);
        return new ObjectBuilder(this);
    }

    /**
     * End the current object (man_end_object).
     *
     * @deprecated Use {@link #object(ObjectType, Consumer)} for automatic scoping instead.
     */
    @Deprecated
    public StreamBuilder endObject() {
        return atom(ManAtom.END_OBJECT);
    }

    // ========== Scoped object building (recommended) ==========

    /**
     * Build an object with automatic scoping - no endObject() needed.
     *
     * <p>The lambda scope ensures proper nesting. Example:
     * <pre>{@code
     * stream.object(ObjectType.VIEW, "Title", obj -> {
     *     obj.data("content");
     *     obj.object(ObjectType.TRIGGER, "Button", btn -> {
     *         btn.onSelect(a -> a.sendTokenArg("LP"));
     *     });
     * });
     * }</pre>
     *
     * @param type The object type
     * @param ops Consumer that configures the object
     * @return this builder for chaining
     */
    public StreamBuilder object(ObjectType type, Consumer<ObjectBuilder> ops) {
        return object(type, null, ops);
    }

    /**
     * Build an object with title and automatic scoping - no endObject() needed.
     *
     * @param type The object type
     * @param title The object title (can be null or empty)
     * @param ops Consumer that configures the object
     * @return this builder for chaining
     */
    public StreamBuilder object(ObjectType type, String title, Consumer<ObjectBuilder> ops) {
        frames.add(new DslAtomFrame(ManAtom.START_OBJECT, type, title != null ? title : ""));
        try {
            ObjectBuilder objBuilder = new ObjectBuilder(this);
            ops.accept(objBuilder);
        } finally {
            frames.add(new DslAtomFrame(ManAtom.END_OBJECT));
        }
        return this;
    }

    // ========== Nested streams ==========

    /**
     * Build a nested stream using a consumer function.
     *
     * @param streamBuilder Consumer that builds the nested stream
     * @return The encoded nested stream bytes
     */
    public byte[] nestedStream(Consumer<StreamBuilder> streamBuilder) throws FdoException {
        StreamBuilder nested = new StreamBuilder(this);
        streamBuilder.accept(nested);
        return nested.compile();
    }

    // ========== Scoped stream building (recommended) ==========

    /**
     * Build a stream block with automatic scoping - no uniEndStream() needed.
     *
     * <p>Emits uni_start_stream at the start and uni_end_stream at the end.
     * Example:
     * <pre>{@code
     * stream.stream(s -> {
     *     s.data("content");
     *     s.sendTokenArg("LP");
     * });
     * }</pre>
     *
     * @param ops Consumer that builds the stream content
     * @return this builder for chaining
     */
    public StreamBuilder stream(Consumer<StreamBuilder> ops) {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM));
        try {
            ops.accept(this);
        } finally {
            frames.add(new DslAtomFrame(UniAtom.END_STREAM));
        }
        return this;
    }

    /**
     * Build a stream block with ID and automatic scoping - no uniEndStream() needed.
     *
     * <p>Emits uni_start_stream with ID at the start and uni_end_stream with ID at the end.
     * Example:
     * <pre>{@code
     * stream.stream("00x", s -> {
     *     s.object(ObjectType.VIEW, "Test", obj -> obj.data("content"));
     * });
     * }</pre>
     *
     * @param id The stream ID (e.g., "00x")
     * @param ops Consumer that builds the stream content
     * @return this builder for chaining
     */
    public StreamBuilder stream(String id, Consumer<StreamBuilder> ops) {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM, id));
        try {
            ops.accept(this);
        } finally {
            frames.add(new DslAtomFrame(UniAtom.END_STREAM, id));
        }
        return this;
    }

    /**
     * Build a stream block with wait-on start and automatic scoping.
     *
     * <p>Emits uni_start_stream_wait_on at the start and uni_end_stream at the end.
     *
     * @param ops Consumer that builds the stream content
     * @return this builder for chaining
     */
    public StreamBuilder streamWaitOn(Consumer<StreamBuilder> ops) {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM_WAIT_ON));
        try {
            ops.accept(this);
        } finally {
            frames.add(new DslAtomFrame(UniAtom.END_STREAM));
        }
        return this;
    }

    // ========== Action building ==========

    /**
     * Set the action criterion (act_set_criterion).
     *
     * <p>Usage examples:
     * <pre>{@code
     * // Using known enum values (IDE autocomplete)
     * .setCriterion(CriterionArg.of(Criterion.SELECT))
     * .setCriterion(CriterionArg.of(Criterion.CLOSE))
     *
     * // Using raw values for unknown criteria
     * .setCriterion(CriterionArg.of(130))
     * .setCriterion(CriterionArg.of("custom_criterion"))
     * }</pre>
     *
     * @param criterion The criterion argument (enum or raw value)
     * @return this builder for chaining
     */
    public StreamBuilder setCriterion(CriterionArg criterion) {
        return atom(ActAtom.SET_CRITERION, criterion);
    }

    /**
     * Set the action criterion from a known Criterion enum value.
     *
     * @param criterion The criterion enum value
     * @return this builder for chaining
     */
    public StreamBuilder setCriterion(Criterion criterion) {
        return atom(ActAtom.SET_CRITERION, criterion);
    }

    /**
     * Add an action with a stream (act_replace_action).
     *
     * @param criterion The action criterion
     * @param actionBuilder Consumer that builds the action stream
     * @return this builder for chaining
     */
    public StreamBuilder setAction(Criterion criterion, Consumer<StreamBuilder> actionBuilder) {
        atom(ActAtom.SET_CRITERION, criterion);

        // Build the action stream
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);

        // Add the action as a nested stream in act_replace_action
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);

        return this;
    }

    // ========== Per-atom typed methods (compile-time type safety) ==========

    /**
     * Set action criterion (act_set_criterion) with compile-time type safety.
     *
     * @param criterion The criterion value
     * @return this builder for chaining
     */
    public StreamBuilder actSetCriterion(Criterion criterion) {
        frames.add(new DslAtomFrame(ActAtom.SET_CRITERION, criterion));
        return this;
    }

    /**
     * Set action criterion (act_set_criterion) with CriterionArg for unknown values.
     *
     * @param criterion The criterion argument (enum or raw)
     * @return this builder for chaining
     */
    public StreamBuilder actSetCriterion(CriterionArg criterion) {
        frames.add(new DslAtomFrame(ActAtom.SET_CRITERION, criterion));
        return this;
    }

    /**
     * Perform action (act_do_action) with compile-time type safety.
     *
     * @param criterion The criterion value
     * @return this builder for chaining
     */
    public StreamBuilder actDoAction(Criterion criterion) {
        frames.add(new DslAtomFrame(ActAtom.DO_ACTION, criterion));
        return this;
    }

    /**
     * Start object (man_start_object) with compile-time type safety.
     *
     * @param type The object type
     * @return this builder for chaining
     */
    public StreamBuilder manStartObject(ObjectType type) {
        frames.add(new DslAtomFrame(ManAtom.START_OBJECT, type, ""));
        return this;
    }

    /**
     * Start object with title (man_start_object) with compile-time type safety.
     *
     * @param type The object type
     * @param title The object title
     * @return this builder for chaining
     */
    public StreamBuilder manStartObject(ObjectType type, String title) {
        frames.add(new DslAtomFrame(ManAtom.START_OBJECT, type, title != null ? title : ""));
        return this;
    }

    /**
     * Start sibling object (man_start_sibling) with compile-time type safety.
     *
     * @param type The object type
     * @return this builder for chaining
     */
    public StreamBuilder manStartSibling(ObjectType type) {
        frames.add(new DslAtomFrame(ManAtom.START_SIBLING, type, ""));
        return this;
    }

    /**
     * Start sibling with title (man_start_sibling) with compile-time type safety.
     *
     * @param type The object type
     * @param title The object title
     * @return this builder for chaining
     */
    public StreamBuilder manStartSibling(ObjectType type, String title) {
        frames.add(new DslAtomFrame(ManAtom.START_SIBLING, type, title != null ? title : ""));
        return this;
    }

    /**
     * Set orientation (mat_orientation) with compile-time type safety.
     *
     * @param orientation The orientation value
     * @return this builder for chaining
     */
    public StreamBuilder matOrientation(Orientation orientation) {
        frames.add(new DslAtomFrame(MatAtom.ORIENTATION, orientation));
        return this;
    }

    /**
     * Set position (mat_position) with compile-time type safety.
     *
     * @param position The position value
     * @return this builder for chaining
     */
    public StreamBuilder matPosition(Position position) {
        frames.add(new DslAtomFrame(MatAtom.POSITION, position));
        return this;
    }

    /**
     * Set font ID (mat_font_id) with compile-time type safety.
     *
     * @param fontId The font ID value
     * @return this builder for chaining
     */
    public StreamBuilder matFontId(FontId fontId) {
        frames.add(new DslAtomFrame(MatAtom.FONT_ID, fontId));
        return this;
    }

    /**
     * Set font style (mat_font_style) with compile-time type safety.
     *
     * @param fontStyle The font style value
     * @return this builder for chaining
     */
    public StreamBuilder matFontStyle(FontStyle fontStyle) {
        frames.add(new DslAtomFrame(MatAtom.FONT_STYLE, fontStyle));
        return this;
    }

    /**
     * Set title position (mat_title_pos) with compile-time type safety.
     *
     * @param titlePos The title position value
     * @return this builder for chaining
     */
    public StreamBuilder matTitlePos(TitlePosition titlePos) {
        frames.add(new DslAtomFrame(MatAtom.TITLE_POS, titlePos));
        return this;
    }

    /**
     * Set log object type (mat_log_object) with compile-time type safety.
     *
     * @param logType The log type value
     * @return this builder for chaining
     */
    public StreamBuilder matLogObject(LogType logType) {
        frames.add(new DslAtomFrame(MatAtom.LOG_OBJECT, logType));
        return this;
    }

    /**
     * Set sort order (mat_sort_order) with compile-time type safety.
     *
     * @param sortOrder The sort order value
     * @return this builder for chaining
     */
    public StreamBuilder matSortOrder(SortOrder sortOrder) {
        frames.add(new DslAtomFrame(MatAtom.SORT_ORDER, sortOrder));
        return this;
    }

    /**
     * Use last atom string (uni_use_last_atom_string) with compile-time type safety.
     *
     * @param atomRef The atom reference (e.g., ManAtom.REPLACE_DATA)
     * @return this builder for chaining
     */
    public StreamBuilder uniUseLastAtomString(DslAtom atomRef) {
        frames.add(new DslAtomFrame(UniAtom.USE_LAST_ATOM_STRING, atomRef));
        return this;
    }

    /**
     * Use last atom value (uni_use_last_atom_value) with compile-time type safety.
     *
     * @param atomRef The atom reference (e.g., MatAtom.VALUE)
     * @return this builder for chaining
     */
    public StreamBuilder uniUseLastAtomValue(DslAtom atomRef) {
        frames.add(new DslAtomFrame(UniAtom.USE_LAST_ATOM_VALUE, atomRef));
        return this;
    }

    // ========== MAN Protocol Methods ==========

    /**
     * End object (man_end_object).
     */
    public StreamBuilder manEndObject() {
        frames.add(new DslAtomFrame(ManAtom.END_OBJECT));
        return this;
    }

    /**
     * Close object (man_close).
     */
    public StreamBuilder manClose() {
        frames.add(new DslAtomFrame(ManAtom.CLOSE));
        return this;
    }

    /**
     * Close object with GID (man_close).
     */
    public StreamBuilder manClose(FdoGid gid) {
        frames.add(new DslAtomFrame(ManAtom.CLOSE, gid));
        return this;
    }

    /**
     * Close children (man_close_children).
     */
    public StreamBuilder manCloseChildren() {
        frames.add(new DslAtomFrame(ManAtom.CLOSE_CHILDREN));
        return this;
    }

    /**
     * Close update (man_close_update).
     */
    public StreamBuilder manCloseUpdate() {
        frames.add(new DslAtomFrame(ManAtom.CLOSE_UPDATE));
        return this;
    }

    /**
     * Set context global ID (man_set_context_globalid).
     */
    public StreamBuilder manSetContextGlobalId(FdoGid gid) {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_GLOBALID, gid));
        return this;
    }

    /**
     * Set context relative (man_set_context_relative).
     */
    public StreamBuilder manSetContextRelative(int offset) {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_RELATIVE, offset));
        return this;
    }

    /**
     * Set context index (man_set_context_index).
     */
    public StreamBuilder manSetContextIndex(int index) {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_INDEX, index));
        return this;
    }

    /**
     * Set context response ID (man_set_context_response_id).
     */
    public StreamBuilder manSetContextResponseId(int responseId) {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_RESPONSE_ID, responseId));
        return this;
    }

    /**
     * Change context relative (man_change_context_relative).
     */
    public StreamBuilder manChangeContextRelative(int delta) {
        frames.add(new DslAtomFrame(ManAtom.CHANGE_CONTEXT_RELATIVE, delta));
        return this;
    }

    /**
     * End context (man_end_context).
     */
    public StreamBuilder manEndContext() {
        frames.add(new DslAtomFrame(ManAtom.END_CONTEXT));
        return this;
    }

    /**
     * Set context first selection (man_set_context_first_selection).
     */
    public StreamBuilder manSetContextFirstSelection() {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_FIRST_SELECTION));
        return this;
    }

    /**
     * Set context next selection (man_set_context_next_selection).
     */
    public StreamBuilder manSetContextNextSelection() {
        frames.add(new DslAtomFrame(ManAtom.SET_CONTEXT_NEXT_SELECTION));
        return this;
    }

    /**
     * Append data (man_append_data) with string.
     */
    public StreamBuilder manAppendData(String data) {
        frames.add(new DslAtomFrame(ManAtom.APPEND_DATA, data));
        return this;
    }

    /**
     * Append data (man_append_data) with bytes.
     */
    public StreamBuilder manAppendData(byte[] data) {
        frames.add(new DslAtomFrame(ManAtom.APPEND_DATA, data));
        return this;
    }

    /**
     * Replace data (man_replace_data).
     */
    public StreamBuilder manReplaceData(String data) {
        frames.add(new DslAtomFrame(ManAtom.REPLACE_DATA, data));
        return this;
    }

    /**
     * Clear object (man_clear_object).
     */
    public StreamBuilder manClearObject() {
        frames.add(new DslAtomFrame(ManAtom.CLEAR_OBJECT));
        return this;
    }

    /**
     * Clear relative (man_clear_relative).
     */
    public StreamBuilder manClearRelative(int offset) {
        frames.add(new DslAtomFrame(ManAtom.CLEAR_RELATIVE, offset));
        return this;
    }

    /**
     * End data (man_end_data).
     */
    public StreamBuilder manEndData() {
        frames.add(new DslAtomFrame(ManAtom.END_DATA));
        return this;
    }

    /**
     * Update display (man_update_display).
     */
    public StreamBuilder manUpdateDisplay() {
        frames.add(new DslAtomFrame(ManAtom.UPDATE_DISPLAY));
        return this;
    }

    /**
     * Update woff end stream (man_update_woff_end_stream).
     */
    public StreamBuilder manUpdateWoffEndStream() {
        frames.add(new DslAtomFrame(ManAtom.UPDATE_WOFF_END_STREAM));
        return this;
    }

    /**
     * Update end object (man_update_end_object).
     */
    public StreamBuilder manUpdateEndObject() {
        frames.add(new DslAtomFrame(ManAtom.UPDATE_END_OBJECT));
        return this;
    }

    /**
     * Force update (man_force_update).
     */
    public StreamBuilder manForceUpdate() {
        frames.add(new DslAtomFrame(ManAtom.FORCE_UPDATE));
        return this;
    }

    /**
     * Make focus (man_make_focus).
     */
    public StreamBuilder manMakeFocus() {
        frames.add(new DslAtomFrame(ManAtom.MAKE_FOCUS));
        return this;
    }

    /**
     * Preset GID (man_preset_gid).
     */
    public StreamBuilder manPresetGid(FdoGid gid) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_GID, gid));
        return this;
    }

    /**
     * Preset title (man_preset_title).
     */
    public StreamBuilder manPresetTitle(String title) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_TITLE, title));
        return this;
    }

    /**
     * Preset URL (man_preset_url).
     */
    public StreamBuilder manPresetUrl(String url) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_URL, url));
        return this;
    }

    /**
     * Preset relative (man_preset_relative).
     */
    public StreamBuilder manPresetRelative(int offset) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_RELATIVE, offset));
        return this;
    }

    /**
     * Preset tag (man_preset_tag).
     */
    public StreamBuilder manPresetTag(String tag) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_TAG, tag));
        return this;
    }

    /**
     * Preset authoring form (man_preset_authoring_form).
     */
    public StreamBuilder manPresetAuthoringForm(FdoGid gid) {
        frames.add(new DslAtomFrame(ManAtom.PRESET_AUTHORING_FORM, gid));
        return this;
    }

    /**
     * Set response ID (man_set_response_id).
     */
    public StreamBuilder manSetResponseId(int responseId) {
        frames.add(new DslAtomFrame(ManAtom.SET_RESPONSE_ID, responseId));
        return this;
    }

    /**
     * Response pop (man_response_pop).
     */
    public StreamBuilder manResponsePop() {
        frames.add(new DslAtomFrame(ManAtom.RESPONSE_POP));
        return this;
    }

    /**
     * Ignore response (man_ignore_response).
     */
    public StreamBuilder manIgnoreResponse() {
        frames.add(new DslAtomFrame(ManAtom.IGNORE_RESPONSE));
        return this;
    }

    /**
     * Do magic token arg (man_do_magic_token_arg).
     */
    public StreamBuilder manDoMagicTokenArg(String token) {
        frames.add(new DslAtomFrame(ManAtom.DO_MAGIC_TOKEN_ARG, token));
        return this;
    }

    /**
     * Do magic response ID (man_do_magic_response_id).
     */
    public StreamBuilder manDoMagicResponseId(int responseId) {
        frames.add(new DslAtomFrame(ManAtom.DO_MAGIC_RESPONSE_ID, responseId));
        return this;
    }

    /**
     * Use default title (man_use_default_title).
     */
    public StreamBuilder manUseDefaultTitle() {
        frames.add(new DslAtomFrame(ManAtom.USE_DEFAULT_TITLE));
        return this;
    }

    /**
     * Set default title (man_set_default_title).
     */
    public StreamBuilder manSetDefaultTitle() {
        frames.add(new DslAtomFrame(ManAtom.SET_DEFAULT_TITLE));
        return this;
    }

    /**
     * Start title (man_start_title).
     */
    public StreamBuilder manStartTitle() {
        frames.add(new DslAtomFrame(ManAtom.START_TITLE));
        return this;
    }

    /**
     * Add title text (man_add_title_text).
     */
    public StreamBuilder manAddTitleText(String text) {
        frames.add(new DslAtomFrame(ManAtom.ADD_TITLE_TEXT, text));
        return this;
    }

    /**
     * Add title tab (man_add_title_tab).
     */
    public StreamBuilder manAddTitleTab() {
        frames.add(new DslAtomFrame(ManAtom.ADD_TITLE_TAB));
        return this;
    }

    /**
     * Add title date time (man_add_title_date_time).
     */
    public StreamBuilder manAddTitleDateTime() {
        frames.add(new DslAtomFrame(ManAtom.ADD_TITLE_DATE_TIME));
        return this;
    }

    /**
     * End title (man_end_title).
     */
    public StreamBuilder manEndTitle() {
        frames.add(new DslAtomFrame(ManAtom.END_TITLE));
        return this;
    }

    /**
     * Enable one shot timer (man_enable_one_shot_timer).
     */
    public StreamBuilder manEnableOneShotTimer(int duration) {
        frames.add(new DslAtomFrame(ManAtom.ENABLE_ONE_SHOT_TIMER, duration));
        return this;
    }

    /**
     * Enable continuous timer (man_enable_continuous_timer).
     */
    public StreamBuilder manEnableContinuousTimer(int duration) {
        frames.add(new DslAtomFrame(ManAtom.ENABLE_CONTINUOUS_TIMER, duration));
        return this;
    }

    /**
     * Kill timer (man_kill_timer).
     */
    public StreamBuilder manKillTimer() {
        frames.add(new DslAtomFrame(ManAtom.KILL_TIMER));
        return this;
    }

    /**
     * Get child count (man_get_child_count).
     */
    public StreamBuilder manGetChildCount() {
        frames.add(new DslAtomFrame(ManAtom.GET_CHILD_COUNT));
        return this;
    }

    /**
     * Get attribute (man_get_attribute).
     */
    public StreamBuilder manGetAttribute(int attr) {
        frames.add(new DslAtomFrame(ManAtom.GET_ATTRIBUTE, attr));
        return this;
    }

    /**
     * Set item type (man_set_item_type).
     */
    public StreamBuilder manSetItemType(int type) {
        frames.add(new DslAtomFrame(ManAtom.SET_ITEM_TYPE, type));
        return this;
    }

    /**
     * Item get (man_item_get).
     */
    public StreamBuilder manItemGet(int index) {
        frames.add(new DslAtomFrame(ManAtom.ITEM_GET, index));
        return this;
    }

    /**
     * Item set (man_item_set).
     */
    public StreamBuilder manItemSet(int index) {
        frames.add(new DslAtomFrame(ManAtom.ITEM_SET, index));
        return this;
    }

    /**
     * Set domain type (man_set_domain_type).
     */
    public StreamBuilder manSetDomainType(int type) {
        frames.add(new DslAtomFrame(ManAtom.SET_DOMAIN_TYPE, type));
        return this;
    }

    /**
     * Set domain info (man_set_domain_info).
     */
    public StreamBuilder manSetDomainInfo(String info) {
        frames.add(new DslAtomFrame(ManAtom.SET_DOMAIN_INFO, info));
        return this;
    }

    /**
     * Place cursor (man_place_cursor).
     */
    public StreamBuilder manPlaceCursor(int position) {
        frames.add(new DslAtomFrame(ManAtom.PLACE_CURSOR, position));
        return this;
    }

    /**
     * Set edit position (man_set_edit_position).
     */
    public StreamBuilder manSetEditPosition(int position) {
        frames.add(new DslAtomFrame(ManAtom.SET_EDIT_POSITION, position));
        return this;
    }

    /**
     * Set edit position to end (man_set_edit_position_to_end).
     */
    public StreamBuilder manSetEditPositionToEnd() {
        frames.add(new DslAtomFrame(ManAtom.SET_EDIT_POSITION_TO_END));
        return this;
    }

    /**
     * Build font list (man_build_font_list).
     */
    public StreamBuilder manBuildFontList() {
        frames.add(new DslAtomFrame(ManAtom.BUILD_FONT_LIST));
        return this;
    }

    /**
     * Spell check (man_spell_check).
     */
    public StreamBuilder manSpellCheck() {
        frames.add(new DslAtomFrame(ManAtom.SPELL_CHECK));
        return this;
    }

    /**
     * Sort items (man_sort_items).
     */
    public StreamBuilder manSortItems() {
        frames.add(new DslAtomFrame(ManAtom.SORT_ITEMS));
        return this;
    }

    /**
     * Display popup menu (man_display_popup_menu).
     */
    public StreamBuilder manDisplayPopupMenu() {
        frames.add(new DslAtomFrame(ManAtom.DISPLAY_POPUP_MENU));
        return this;
    }

    /**
     * Logging command (man_logging_command).
     */
    public StreamBuilder manLoggingCommand(int cmd) {
        frames.add(new DslAtomFrame(ManAtom.LOGGING_COMMAND, cmd));
        return this;
    }

    /**
     * Get index by title (man_get_index_by_title).
     */
    public StreamBuilder manGetIndexByTitle(String title) {
        frames.add(new DslAtomFrame(ManAtom.GET_INDEX_BY_TITLE, title));
        return this;
    }

    /**
     * Accessibility setting (man_accessibility_setting).
     */
    public StreamBuilder manAccessibilitySetting(int setting) {
        frames.add(new DslAtomFrame(ManAtom.ACCESSIBILITY_SETTING, setting));
        return this;
    }

    /**
     * Treectrl action command (man_treectrl_action_command).
     */
    public StreamBuilder manTreectrlActionCommand(int cmd) {
        frames.add(new DslAtomFrame(ManAtom.TREECTRL_ACTION_COMMAND, cmd));
        return this;
    }

    // ========== MAT Protocol Methods ==========

    /**
     * Set size (mat_size) with rows and cols.
     */
    public StreamBuilder matSize(int rows, int cols) {
        frames.add(new DslAtomFrame(MatAtom.SIZE, rows, cols));
        return this;
    }

    /**
     * Set size (mat_size) with rows, cols, and max chars.
     */
    public StreamBuilder matSize(int rows, int cols, int maxChars) {
        frames.add(new DslAtomFrame(MatAtom.SIZE, rows, cols, maxChars));
        return this;
    }

    /**
     * Set width (mat_width).
     */
    public StreamBuilder matWidth(int width) {
        frames.add(new DslAtomFrame(MatAtom.WIDTH, width));
        return this;
    }

    /**
     * Set height (mat_height).
     */
    public StreamBuilder matHeight(int height) {
        frames.add(new DslAtomFrame(MatAtom.HEIGHT, height));
        return this;
    }

    /**
     * Set capacity (mat_capacity).
     */
    public StreamBuilder matCapacity(int capacity) {
        frames.add(new DslAtomFrame(MatAtom.CAPACITY, capacity));
        return this;
    }

    /**
     * Set precise X (mat_precise_x).
     */
    public StreamBuilder matPreciseX(int x) {
        frames.add(new DslAtomFrame(MatAtom.PRECISE_X, x));
        return this;
    }

    /**
     * Set precise Y (mat_precise_y).
     */
    public StreamBuilder matPreciseY(int y) {
        frames.add(new DslAtomFrame(MatAtom.PRECISE_Y, y));
        return this;
    }

    /**
     * Set precise width (mat_precise_width).
     */
    public StreamBuilder matPreciseWidth(int width) {
        frames.add(new DslAtomFrame(MatAtom.PRECISE_WIDTH, width));
        return this;
    }

    /**
     * Set precise height (mat_precise_height).
     */
    public StreamBuilder matPreciseHeight(int height) {
        frames.add(new DslAtomFrame(MatAtom.PRECISE_HEIGHT, height));
        return this;
    }

    /**
     * Set title (mat_title).
     */
    public StreamBuilder matTitle(String title) {
        frames.add(new DslAtomFrame(MatAtom.TITLE, title));
        return this;
    }

    /**
     * Set title width (mat_title_width).
     */
    public StreamBuilder matTitleWidth(int width) {
        frames.add(new DslAtomFrame(MatAtom.TITLE_WIDTH, width));
        return this;
    }

    /**
     * Set title access (mat_title_access).
     */
    public StreamBuilder matTitleAccess(int access) {
        frames.add(new DslAtomFrame(MatAtom.TITLE_ACCESS, access));
        return this;
    }

    /**
     * Set title append screen name (mat_title_append_screen_name).
     */
    public StreamBuilder matTitleAppendScreenName(String name) {
        frames.add(new DslAtomFrame(MatAtom.TITLE_APPEND_SCREEN_NAME, name));
        return this;
    }

    /**
     * Set font size (mat_font_size).
     */
    public StreamBuilder matFontSize(int size) {
        frames.add(new DslAtomFrame(MatAtom.FONT_SIZE, size));
        return this;
    }

    /**
     * Set font SIS (mat_font_sis) - font id, size, style combo.
     */
    public StreamBuilder matFontSis(FontId font, int size, FontStyle style) {
        frames.add(new DslAtomFrame(MatAtom.FONT_SIS, font.code(), size, style.code()));
        return this;
    }

    /**
     * Set intl font SIS (mat_intl_font_sis).
     */
    public StreamBuilder matIntlFontSis(int intl, FontId font, int size, FontStyle style) {
        frames.add(new DslAtomFrame(MatAtom.INTL_FONT_SIS, intl, font.code(), size, style.code()));
        return this;
    }

    /**
     * Set value (mat_value).
     */
    public StreamBuilder matValue(int value) {
        frames.add(new DslAtomFrame(MatAtom.VALUE, value));
        return this;
    }

    /**
     * Set minimum (mat_minimum).
     */
    public StreamBuilder matMinimum(int min) {
        frames.add(new DslAtomFrame(MatAtom.MINIMUM, min));
        return this;
    }

    /**
     * Set maximum (mat_maximum).
     */
    public StreamBuilder matMaximum(int max) {
        frames.add(new DslAtomFrame(MatAtom.MAXIMUM, max));
        return this;
    }

    /**
     * Set increment (mat_increment).
     */
    public StreamBuilder matIncrement(int increment) {
        frames.add(new DslAtomFrame(MatAtom.INCREMENT, increment));
        return this;
    }

    /**
     * Set horizontal scroll value (mat_horz_scroll_value).
     */
    public StreamBuilder matHorzScrollValue(int value) {
        frames.add(new DslAtomFrame(MatAtom.HORZ_SCROLL_VALUE, value));
        return this;
    }

    /**
     * Set vertical scroll value (mat_vert_scroll_value).
     */
    public StreamBuilder matVertScrollValue(int value) {
        frames.add(new DslAtomFrame(MatAtom.VERT_SCROLL_VALUE, value));
        return this;
    }

    /**
     * Set horizontal scroll capacity (mat_horz_scroll_capacity).
     */
    public StreamBuilder matHorzScrollCapacity(int capacity) {
        frames.add(new DslAtomFrame(MatAtom.HORZ_SCROLL_CAPACITY, capacity));
        return this;
    }

    /**
     * Set vertical scroll capacity (mat_vert_scroll_capacity).
     */
    public StreamBuilder matVertScrollCapacity(int capacity) {
        frames.add(new DslAtomFrame(MatAtom.VERT_SCROLL_CAPACITY, capacity));
        return this;
    }

    /**
     * Set scroll threshold (mat_scroll_threshold).
     */
    public StreamBuilder matScrollThreshold(int threshold) {
        frames.add(new DslAtomFrame(MatAtom.SCROLL_THRESHOLD, threshold));
        return this;
    }

    /**
     * Set color face (mat_color_face).
     */
    public StreamBuilder matColorFace(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_FACE, color));
        return this;
    }

    /**
     * Set color text (mat_color_text).
     */
    public StreamBuilder matColorText(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_TEXT, color));
        return this;
    }

    /**
     * Set color top edge (mat_color_top_edge).
     */
    public StreamBuilder matColorTopEdge(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_TOP_EDGE, color));
        return this;
    }

    /**
     * Set color bottom edge (mat_color_bottom_edge).
     */
    public StreamBuilder matColorBottomEdge(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_BOTTOM_EDGE, color));
        return this;
    }

    /**
     * Set color selected (mat_color_selected).
     */
    public StreamBuilder matColorSelected(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_SELECTED, color));
        return this;
    }

    /**
     * Set color text shadow (mat_color_text_shadow).
     */
    public StreamBuilder matColorTextShadow(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_TEXT_SHADOW, color));
        return this;
    }

    /**
     * Set color frame hilight (mat_color_frame_hilight).
     */
    public StreamBuilder matColorFrameHilight(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_FRAME_HILIGHT, color));
        return this;
    }

    /**
     * Set color frame shadow (mat_color_frame_shadow).
     */
    public StreamBuilder matColorFrameShadow(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_FRAME_SHADOW, color));
        return this;
    }

    /**
     * Set color thumb (mat_color_thumb).
     */
    public StreamBuilder matColorThumb(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_THUMB, color));
        return this;
    }

    /**
     * Set color channel (mat_color_channel).
     */
    public StreamBuilder matColorChannel(int color) {
        frames.add(new DslAtomFrame(MatAtom.COLOR_CHANNEL, color));
        return this;
    }

    /**
     * Set art ID (mat_art_id).
     */
    public StreamBuilder matArtId(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.ART_ID, gid));
        return this;
    }

    /**
     * Set art frame (mat_art_frame).
     */
    public StreamBuilder matArtFrame(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.ART_FRAME, gid));
        return this;
    }

    /**
     * Set art animation rate (mat_art_animation_rate).
     */
    public StreamBuilder matArtAnimationRate(int rate) {
        frames.add(new DslAtomFrame(MatAtom.ART_ANIMATION_RATE, rate));
        return this;
    }

    /**
     * Set art animation seq (mat_art_animation_seq).
     */
    public StreamBuilder matArtAnimationSeq(int seq) {
        frames.add(new DslAtomFrame(MatAtom.ART_ANIMATION_SEQ, seq));
        return this;
    }

    /**
     * Set art seq (mat_art_seq).
     */
    public StreamBuilder matArtSeq(int seq) {
        frames.add(new DslAtomFrame(MatAtom.ART_SEQ, seq));
        return this;
    }

    /**
     * Set form icon (mat_form_icon).
     */
    public StreamBuilder matFormIcon(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.FORM_ICON, gid));
        return this;
    }

    /**
     * Set art hint width (mat_art_hint_width).
     */
    public StreamBuilder matArtHintWidth(int width) {
        frames.add(new DslAtomFrame(MatAtom.ART_HINT_WIDTH, width));
        return this;
    }

    /**
     * Set art hint height (mat_art_hint_height).
     */
    public StreamBuilder matArtHintHeight(int height) {
        frames.add(new DslAtomFrame(MatAtom.ART_HINT_HEIGHT, height));
        return this;
    }

    /**
     * Set art hint title (mat_art_hint_title).
     */
    public StreamBuilder matArtHintTitle(String title) {
        frames.add(new DslAtomFrame(MatAtom.ART_HINT_TITLE, title));
        return this;
    }

    /**
     * Set art hint placeholder ID (mat_art_hint_placeholder_id).
     */
    public StreamBuilder matArtHintPlaceholderId(int id) {
        frames.add(new DslAtomFrame(MatAtom.ART_HINT_PLACEHOLDER_ID, id));
        return this;
    }

    /**
     * Set frame style (mat_frame_style).
     */
    public StreamBuilder matFrameStyle(FrameStyle style) {
        frames.add(new DslAtomFrame(MatAtom.FRAME_STYLE, (style.code() >> 8) & 0xFF, style.code() & 0xFF));
        return this;
    }

    /**
     * Set trigger style (mat_trigger_style).
     */
    public StreamBuilder matTriggerStyle(TriggerStyle style) {
        frames.add(new DslAtomFrame(MatAtom.TRIGGER_STYLE, style));
        return this;
    }

    /**
     * Set style ID (mat_style_id).
     */
    public StreamBuilder matStyleId(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.STYLE_ID, gid));
        return this;
    }

    /**
     * Set URL (mat_url).
     */
    public StreamBuilder matUrl(String url) {
        frames.add(new DslAtomFrame(MatAtom.URL, url));
        return this;
    }

    /**
     * Set URL next (mat_url_next).
     */
    public StreamBuilder matUrlNext(String url) {
        frames.add(new DslAtomFrame(MatAtom.URL_NEXT, url));
        return this;
    }

    /**
     * Set URL prev (mat_url_prev).
     */
    public StreamBuilder matUrlPrev(String url) {
        frames.add(new DslAtomFrame(MatAtom.URL_PREV, url));
        return this;
    }

    /**
     * Set URL parent (mat_url_parent).
     */
    public StreamBuilder matUrlParent(String url) {
        frames.add(new DslAtomFrame(MatAtom.URL_PARENT, url));
        return this;
    }

    /**
     * Set URL list (mat_url_list).
     */
    public StreamBuilder matUrlList(String urls) {
        frames.add(new DslAtomFrame(MatAtom.URL_LIST, urls));
        return this;
    }

    /**
     * Set timer event (mat_timer_event).
     */
    public StreamBuilder matTimerEvent(int event) {
        frames.add(new DslAtomFrame(MatAtom.TIMER_EVENT, event));
        return this;
    }

    /**
     * Set timer duration (mat_timer_duration).
     */
    public StreamBuilder matTimerDuration(int duration) {
        frames.add(new DslAtomFrame(MatAtom.TIMER_DURATION, duration));
        return this;
    }

    /**
     * Set vertical spacing (mat_vertical_spacing).
     */
    public StreamBuilder matVerticalSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.VERTICAL_SPACING, spacing));
        return this;
    }

    /**
     * Set horizontal spacing (mat_horizontal_spacing).
     */
    public StreamBuilder matHorizontalSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.HORIZONTAL_SPACING, spacing));
        return this;
    }

    /**
     * Set spacing (mat_spacing).
     */
    public StreamBuilder matSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.SPACING, spacing));
        return this;
    }

    /**
     * Set left spacing (mat_left_spacing).
     */
    public StreamBuilder matLeftSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.LEFT_SPACING, spacing));
        return this;
    }

    /**
     * Set top spacing (mat_top_spacing).
     */
    public StreamBuilder matTopSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.TOP_SPACING, spacing));
        return this;
    }

    /**
     * Set right spacing (mat_right_spacing).
     */
    public StreamBuilder matRightSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.RIGHT_SPACING, spacing));
        return this;
    }

    /**
     * Set bottom spacing (mat_bottom_spacing).
     */
    public StreamBuilder matBottomSpacing(int spacing) {
        frames.add(new DslAtomFrame(MatAtom.BOTTOM_SPACING, spacing));
        return this;
    }

    /**
     * Set relative tag (mat_relative_tag).
     */
    public StreamBuilder matRelativeTag(int tag) {
        frames.add(new DslAtomFrame(MatAtom.RELATIVE_TAG, tag));
        return this;
    }

    /**
     * Set object ID (mat_object_id).
     */
    public StreamBuilder matObjectId(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.OBJECT_ID, gid));
        return this;
    }

    /**
     * Set object type (mat_object_type).
     */
    public StreamBuilder matObjectType(ObjectType type) {
        frames.add(new DslAtomFrame(MatAtom.OBJECT_TYPE, type));
        return this;
    }

    /**
     * Set object index (mat_object_index).
     */
    public StreamBuilder matObjectIndex(int index) {
        frames.add(new DslAtomFrame(MatAtom.OBJECT_INDEX, index));
        return this;
    }

    /**
     * Set ruler (mat_ruler).
     */
    public StreamBuilder matRuler(int ruler) {
        frames.add(new DslAtomFrame(MatAtom.RULER, ruler));
        return this;
    }

    /**
     * Set border (mat_border).
     */
    public StreamBuilder matBorder(int border) {
        frames.add(new DslAtomFrame(MatAtom.BORDER, border));
        return this;
    }

    /**
     * Set paragraph (mat_paragraph).
     */
    public StreamBuilder matParagraph(int para) {
        frames.add(new DslAtomFrame(MatAtom.PARAGRAPH, para));
        return this;
    }

    /**
     * Set command key (mat_command_key).
     */
    public StreamBuilder matCommandKey(int key) {
        frames.add(new DslAtomFrame(MatAtom.COMMAND_KEY, key));
        return this;
    }

    /**
     * Set shortcut key (mat_shortcut_key).
     */
    public StreamBuilder matShortcutKey(int key) {
        frames.add(new DslAtomFrame(MatAtom.SHORTCUT_KEY, key));
        return this;
    }

    /**
     * Set validation (mat_validation).
     */
    public StreamBuilder matValidation(int val) {
        frames.add(new DslAtomFrame(MatAtom.VALIDATION, val));
        return this;
    }

    /**
     * Set managed by (mat_managed_by).
     */
    public StreamBuilder matManagedBy(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.MANAGED_BY, gid));
        return this;
    }

    /**
     * Set iconify as (mat_iconify_as).
     */
    public StreamBuilder matIconifyAs(int iconify) {
        frames.add(new DslAtomFrame(MatAtom.ICONIFY_AS, iconify));
        return this;
    }

    /**
     * Set plus group (mat_plus_group).
     */
    public StreamBuilder matPlusGroup(int group) {
        frames.add(new DslAtomFrame(MatAtom.PLUS_GROUP, group));
        return this;
    }

    /**
     * Set unfocused (mat_unfocused).
     */
    public StreamBuilder matUnfocused(int val) {
        frames.add(new DslAtomFrame(MatAtom.UNFOCUSED, val));
        return this;
    }

    /**
     * Set dirty query (mat_dirty_query).
     */
    public StreamBuilder matDirtyQuery(int query) {
        frames.add(new DslAtomFrame(MatAtom.DIRTY_QUERY, query));
        return this;
    }

    /**
     * Set link content to RID (mat_link_content_to_rid).
     */
    public StreamBuilder matLinkContentToRid(int rid) {
        frames.add(new DslAtomFrame(MatAtom.LINK_CONTENT_TO_RID, rid));
        return this;
    }

    /**
     * Set context help (mat_context_help).
     */
    public StreamBuilder matContextHelp(String help) {
        frames.add(new DslAtomFrame(MatAtom.CONTEXT_HELP, help));
        return this;
    }

    /**
     * Set drop data type (mat_drop_data_type).
     */
    public StreamBuilder matDropDataType(int type) {
        frames.add(new DslAtomFrame(MatAtom.DROP_DATA_TYPE, type));
        return this;
    }

    /**
     * Set field script (mat_field_script).
     */
    public StreamBuilder matFieldScript(String script) {
        frames.add(new DslAtomFrame(MatAtom.FIELD_SCRIPT, script));
        return this;
    }

    /**
     * Set encode type (mat_encode_type).
     */
    public StreamBuilder matEncodeType(int type) {
        frames.add(new DslAtomFrame(MatAtom.ENCODE_TYPE, type));
        return this;
    }

    /**
     * Set sink (mat_sink).
     */
    public StreamBuilder matSink(int sink) {
        frames.add(new DslAtomFrame(MatAtom.SINK, sink));
        return this;
    }

    /**
     * Set content tag (mat_content_tag).
     */
    public StreamBuilder matContentTag(String tag) {
        frames.add(new DslAtomFrame(MatAtom.CONTENT_TAG, tag));
        return this;
    }

    /**
     * Set language sensitive (mat_language_sensitive).
     */
    public StreamBuilder matLanguageSensitive(int lang) {
        frames.add(new DslAtomFrame(MatAtom.LANGUAGE_SENSITIVE, lang));
        return this;
    }

    /**
     * Set default extract type (mat_set_dflt_extract_type).
     */
    public StreamBuilder matSetDfltExtractType(int type) {
        frames.add(new DslAtomFrame(MatAtom.SET_DFLT_EXTRACT_TYPE, type));
        return this;
    }

    /**
     * Set secure form (mat_secure_form).
     */
    public StreamBuilder matSecureForm(int secure) {
        frames.add(new DslAtomFrame(MatAtom.SECURE_FORM, secure));
        return this;
    }

    /**
     * Set secure field (mat_secure_field).
     */
    public StreamBuilder matSecureField(int secure) {
        frames.add(new DslAtomFrame(MatAtom.SECURE_FIELD, secure));
        return this;
    }

    /**
     * Set auto complete (mat_auto_complete).
     */
    public StreamBuilder matAutoComplete(int auto) {
        frames.add(new DslAtomFrame(MatAtom.AUTO_COMPLETE, auto));
        return this;
    }

    /**
     * Set factory ID (mat_factory_id).
     */
    public StreamBuilder matFactoryId(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.FACTORY_ID, gid));
        return this;
    }

    /**
     * Set treectrl set class (mat_treectrl_set_class).
     */
    public StreamBuilder matTreectrlSetClass(int cls) {
        frames.add(new DslAtomFrame(MatAtom.TREECTRL_SET_CLASS, cls));
        return this;
    }

    /**
     * Set ctrl attribute (mat_ctrl_attribute).
     */
    public StreamBuilder matCtrlAttribute(int attr) {
        frames.add(new DslAtomFrame(MatAtom.CTRL_ATTRIBUTE, attr));
        return this;
    }

    /**
     * Set navarrow pos (mat_navarrow_pos).
     */
    public StreamBuilder matNavarrowPos(int pos) {
        frames.add(new DslAtomFrame(MatAtom.NAVARROW_POS, pos));
        return this;
    }

    /**
     * Set navarrow art (mat_navarrow_art).
     */
    public StreamBuilder matNavarrowArt(FdoGid gid) {
        frames.add(new DslAtomFrame(MatAtom.NAVARROW_ART, gid));
        return this;
    }

    /**
     * Set navarrow pos X (mat_navarrow_pos_x).
     */
    public StreamBuilder matNavarrowPosX(int x) {
        frames.add(new DslAtomFrame(MatAtom.NAVARROW_POS_X, x));
        return this;
    }

    /**
     * Set navarrow pos Y (mat_navarrow_pos_y).
     */
    public StreamBuilder matNavarrowPosY(int y) {
        frames.add(new DslAtomFrame(MatAtom.NAVARROW_POS_Y, y));
        return this;
    }

    /**
     * Set sage context help (mat_sage_context_help).
     */
    public StreamBuilder matSageContextHelp(String help) {
        frames.add(new DslAtomFrame(MatAtom.SAGE_CONTEXT_HELP, help));
        return this;
    }

    /**
     * Set text on picture pos (mat_text_on_picture_pos).
     */
    public StreamBuilder matTextOnPicturePos(int pos) {
        frames.add(new DslAtomFrame(MatAtom.TEXT_ON_PICTURE_POS, pos));
        return this;
    }

    /**
     * Set thumb size (mat_thumb_size).
     */
    public StreamBuilder matThumbSize(int size) {
        frames.add(new DslAtomFrame(MatAtom.THUMB_SIZE, size));
        return this;
    }

    /**
     * Set tab set cur sel (mat_tab_set_cur_sel).
     */
    public StreamBuilder matTabSetCurSel(int sel) {
        frames.add(new DslAtomFrame(MatAtom.TAB_SET_CUR_SEL, sel));
        return this;
    }

    /**
     * Get tab cur sel (mat_tab_get_cur_sel).
     */
    public StreamBuilder matTabGetCurSel() {
        frames.add(new DslAtomFrame(MatAtom.TAB_GET_CUR_SEL));
        return this;
    }

    /**
     * Set popup relative ID (mat_popup_relative_id).
     */
    public StreamBuilder matPopupRelativeId(int id) {
        frames.add(new DslAtomFrame(MatAtom.POPUP_RELATIVE_ID, id));
        return this;
    }

    /**
     * Set popup PFC path (mat_popup_pfc_path).
     */
    public StreamBuilder matPopupPfcPath(String path) {
        frames.add(new DslAtomFrame(MatAtom.POPUP_PFC_PATH, path));
        return this;
    }

    // Boolean MAT atoms (no-arg methods)
    public StreamBuilder matBoolVerticalScroll() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_VERTICAL_SCROLL));
        return this;
    }

    public StreamBuilder matBoolHorizontalScroll() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_HORIZONTAL_SCROLL));
        return this;
    }

    public StreamBuilder matBoolDisabled() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DISABLED));
        return this;
    }

    public StreamBuilder matBoolDefault() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT));
        return this;
    }

    public StreamBuilder matBoolResizeVertical() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_VERTICAL));
        return this;
    }

    public StreamBuilder matBoolResizeHorizontal() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_HORIZONTAL));
        return this;
    }

    public StreamBuilder matBoolModal() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_MODAL));
        return this;
    }

    public StreamBuilder matBoolInvisible() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_INVISIBLE));
        return this;
    }

    public StreamBuilder matBoolHidden() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_HIDDEN));
        return this;
    }

    public StreamBuilder matBoolListIcons() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ICONS));
        return this;
    }

    public StreamBuilder matBoolGraphicView() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_GRAPHIC_VIEW));
        return this;
    }

    public StreamBuilder matBoolPalette() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE));
        return this;
    }

    public StreamBuilder matBoolForceScroll() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_SCROLL));
        return this;
    }

    public StreamBuilder matBoolProtectedInput() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PROTECTED_INPUT));
        return this;
    }

    public StreamBuilder matBoolForceNoScroll() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_NO_SCROLL));
        return this;
    }

    public StreamBuilder matBoolNonCloseable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_NON_CLOSEABLE));
        return this;
    }

    public StreamBuilder matBoolExportable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_EXPORTABLE));
        return this;
    }

    public StreamBuilder matBoolImportable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_IMPORTABLE));
        return this;
    }

    public StreamBuilder matBoolWriteable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_WRITEABLE));
        return this;
    }

    public StreamBuilder matBoolFloating() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_FLOATING));
        return this;
    }

    public StreamBuilder matBoolContiguous() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CONTIGUOUS));
        return this;
    }

    public StreamBuilder matBoolMenu() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_MENU));
        return this;
    }

    public StreamBuilder matBoolDefaultSend() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_SEND));
        return this;
    }

    public StreamBuilder matBoolDoubleSpace() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DOUBLE_SPACE));
        return this;
    }

    public StreamBuilder matBoolInvert() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_INVERT));
        return this;
    }

    public StreamBuilder matBoolPermanent() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PERMANENT));
        return this;
    }

    public StreamBuilder matBoolIgnore() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE));
        return this;
    }

    public StreamBuilder matBoolNoBorder() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_NO_BORDER));
        return this;
    }

    public StreamBuilder matBoolModified() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_MODIFIED));
        return this;
    }

    public StreamBuilder matBoolPrecise() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PRECISE));
        return this;
    }

    public StreamBuilder matBoolGradualShadow() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_GRADUAL_SHADOW));
        return this;
    }

    public StreamBuilder matBoolBackgroundPic() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_PIC));
        return this;
    }

    public StreamBuilder matBoolBackgroundFlood() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_FLOOD));
        return this;
    }

    public StreamBuilder matBoolRepeatAnimation() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_REPEAT_ANIMATION));
        return this;
    }

    public StreamBuilder matBoolBackgroundTile() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_TILE));
        return this;
    }

    public StreamBuilder matBoolFirstScript() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_FIRST_SCRIPT));
        return this;
    }

    public StreamBuilder matBoolListAllowEntry() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ALLOW_ENTRY));
        return this;
    }

    public StreamBuilder matBoolExpandToFit() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_EXPAND_TO_FIT));
        return this;
    }

    public StreamBuilder matBoolSane() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SANE));
        return this;
    }

    public StreamBuilder matBoolUrlSink() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_URL_SINK));
        return this;
    }

    public StreamBuilder matBoolDropAtTop() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DROP_AT_TOP));
        return this;
    }

    public StreamBuilder matBoolLanguagePopup() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_LANGUAGE_POPUP));
        return this;
    }

    public StreamBuilder matBoolPaletteArt() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE_ART));
        return this;
    }

    public StreamBuilder matBoolToolGroup() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_TOOL_GROUP));
        return this;
    }

    public StreamBuilder matBoolSmallIcon() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SMALL_ICON));
        return this;
    }

    public StreamBuilder matBoolEncodeUnicode() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_ENCODE_UNICODE));
        return this;
    }

    public StreamBuilder matBoolPageControl() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_PAGE_CONTROL));
        return this;
    }

    public StreamBuilder matBoolSpinner() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SPINNER));
        return this;
    }

    public StreamBuilder matBoolDetached() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHED));
        return this;
    }

    public StreamBuilder matBoolCustomizable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CUSTOMIZABLE));
        return this;
    }

    public StreamBuilder matBoolDetachable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHABLE));
        return this;
    }

    public StreamBuilder matBoolDockHorizontal() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_HORIZONTAL));
        return this;
    }

    public StreamBuilder matBoolDockVertical() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_VERTICAL));
        return this;
    }

    public StreamBuilder matBoolChildrenRemovable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_REMOVABLE));
        return this;
    }

    public StreamBuilder matBoolChildrenMovable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_MOVABLE));
        return this;
    }

    public StreamBuilder matBoolChildRemovable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_REMOVABLE));
        return this;
    }

    public StreamBuilder matBoolChildMovable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_MOVABLE));
        return this;
    }

    public StreamBuilder matBoolChildLineFeed() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_LINE_FEED));
        return this;
    }

    public StreamBuilder matBoolSharedStyle() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SHARED_STYLE));
        return this;
    }

    public StreamBuilder matBoolActiveOffline() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_OFFLINE));
        return this;
    }

    public StreamBuilder matBoolActiveOnline() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_ONLINE));
        return this;
    }

    public StreamBuilder matBoolInactiveForGuest() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_INACTIVE_FOR_GUEST));
        return this;
    }

    public StreamBuilder matBoolDropdownButton() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DROPDOWN_BUTTON));
        return this;
    }

    public StreamBuilder matBoolPopupMenu() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_POPUP_MENU));
        return this;
    }

    public StreamBuilder matBoolIgnoreUrlList() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL_LIST));
        return this;
    }

    public StreamBuilder matBoolDrawFocus() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DRAW_FOCUS));
        return this;
    }

    public StreamBuilder matBoolLoggable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_LOGGABLE));
        return this;
    }

    public StreamBuilder matBoolHideUrl() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_URL));
        return this;
    }

    public StreamBuilder matBoolAutoCloseable() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_AUTO_CLOSEABLE));
        return this;
    }

    public StreamBuilder matBoolSignoffMenu() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SIGNOFF_MENU));
        return this;
    }

    public StreamBuilder matBoolIgnoreUrl() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL));
        return this;
    }

    public StreamBuilder matBoolSavableToPfc() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_SAVABLE_TO_PFC));
        return this;
    }

    public StreamBuilder matBoolStaticUrl() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_STATIC_URL));
        return this;
    }

    public StreamBuilder matBoolAllowTabbing() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_ALLOW_TABBING));
        return this;
    }

    public StreamBuilder matBoolDefaultTrigger() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_TRIGGER));
        return this;
    }

    public StreamBuilder matBoolHideTicks() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_TICKS));
        return this;
    }

    public StreamBuilder matBoolIsSlider() {
        frames.add(new DslAtomFrame(MatAtom.BOOL_IS_SLIDER));
        return this;
    }

    // Boolean MAT atoms (with boolean parameter for explicit yes/no)
    public StreamBuilder matBoolVerticalScroll(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_VERTICAL_SCROLL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_VERTICAL_SCROLL, false));
        }
        return this;
    }

    public StreamBuilder matBoolHorizontalScroll(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HORIZONTAL_SCROLL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HORIZONTAL_SCROLL, false));
        }
        return this;
    }

    public StreamBuilder matBoolDisabled(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DISABLED));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DISABLED, false));
        }
        return this;
    }

    public StreamBuilder matBoolDefault(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT, false));
        }
        return this;
    }

    public StreamBuilder matBoolResizeVertical(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_VERTICAL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_VERTICAL, false));
        }
        return this;
    }

    public StreamBuilder matBoolResizeHorizontal(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_HORIZONTAL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_RESIZE_HORIZONTAL, false));
        }
        return this;
    }

    public StreamBuilder matBoolModal(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MODAL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MODAL, false));
        }
        return this;
    }

    public StreamBuilder matBoolInvisible(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INVISIBLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INVISIBLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolHidden(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDDEN));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDDEN, false));
        }
        return this;
    }

    public StreamBuilder matBoolListIcons(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ICONS));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ICONS, false));
        }
        return this;
    }

    public StreamBuilder matBoolGraphicView(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_GRAPHIC_VIEW));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_GRAPHIC_VIEW, false));
        }
        return this;
    }

    public StreamBuilder matBoolPalette(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE, false));
        }
        return this;
    }

    public StreamBuilder matBoolForceScroll(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_SCROLL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_SCROLL, false));
        }
        return this;
    }

    public StreamBuilder matBoolProtectedInput(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PROTECTED_INPUT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PROTECTED_INPUT, false));
        }
        return this;
    }

    public StreamBuilder matBoolForceNoScroll(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_NO_SCROLL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FORCE_NO_SCROLL, false));
        }
        return this;
    }

    public StreamBuilder matBoolNonCloseable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_NON_CLOSEABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_NON_CLOSEABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolExportable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_EXPORTABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_EXPORTABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolImportable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IMPORTABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IMPORTABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolWriteable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_WRITEABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_WRITEABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolFloating(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FLOATING));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FLOATING, false));
        }
        return this;
    }

    public StreamBuilder matBoolContiguous(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CONTIGUOUS));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CONTIGUOUS, false));
        }
        return this;
    }

    public StreamBuilder matBoolMenu(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MENU));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MENU, false));
        }
        return this;
    }

    public StreamBuilder matBoolDefaultSend(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_SEND));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_SEND, false));
        }
        return this;
    }

    public StreamBuilder matBoolDoubleSpace(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOUBLE_SPACE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOUBLE_SPACE, false));
        }
        return this;
    }

    public StreamBuilder matBoolInvert(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INVERT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INVERT, false));
        }
        return this;
    }

    public StreamBuilder matBoolPermanent(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PERMANENT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PERMANENT, false));
        }
        return this;
    }

    public StreamBuilder matBoolIgnore(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE, false));
        }
        return this;
    }

    public StreamBuilder matBoolNoBorder(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_NO_BORDER));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_NO_BORDER, false));
        }
        return this;
    }

    public StreamBuilder matBoolModified(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MODIFIED));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_MODIFIED, false));
        }
        return this;
    }

    public StreamBuilder matBoolPrecise(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PRECISE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PRECISE, false));
        }
        return this;
    }

    public StreamBuilder matBoolGradualShadow(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_GRADUAL_SHADOW));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_GRADUAL_SHADOW, false));
        }
        return this;
    }

    public StreamBuilder matBoolBackgroundPic(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_PIC));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_PIC, false));
        }
        return this;
    }

    public StreamBuilder matBoolBackgroundFlood(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_FLOOD));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_FLOOD, false));
        }
        return this;
    }

    public StreamBuilder matBoolRepeatAnimation(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_REPEAT_ANIMATION));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_REPEAT_ANIMATION, false));
        }
        return this;
    }

    public StreamBuilder matBoolBackgroundTile(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_TILE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_BACKGROUND_TILE, false));
        }
        return this;
    }

    public StreamBuilder matBoolFirstScript(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FIRST_SCRIPT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_FIRST_SCRIPT, false));
        }
        return this;
    }

    public StreamBuilder matBoolListAllowEntry(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ALLOW_ENTRY));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LIST_ALLOW_ENTRY, false));
        }
        return this;
    }

    public StreamBuilder matBoolExpandToFit(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_EXPAND_TO_FIT));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_EXPAND_TO_FIT, false));
        }
        return this;
    }

    public StreamBuilder matBoolSane(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SANE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SANE, false));
        }
        return this;
    }

    public StreamBuilder matBoolUrlSink(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_URL_SINK));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_URL_SINK, false));
        }
        return this;
    }

    public StreamBuilder matBoolDropAtTop(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DROP_AT_TOP));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DROP_AT_TOP, false));
        }
        return this;
    }

    public StreamBuilder matBoolLanguagePopup(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LANGUAGE_POPUP));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LANGUAGE_POPUP, false));
        }
        return this;
    }

    public StreamBuilder matBoolPaletteArt(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE_ART));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PALETTE_ART, false));
        }
        return this;
    }

    public StreamBuilder matBoolToolGroup(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_TOOL_GROUP));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_TOOL_GROUP, false));
        }
        return this;
    }

    public StreamBuilder matBoolSmallIcon(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SMALL_ICON));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SMALL_ICON, false));
        }
        return this;
    }

    public StreamBuilder matBoolEncodeUnicode(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ENCODE_UNICODE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ENCODE_UNICODE, false));
        }
        return this;
    }

    public StreamBuilder matBoolPageControl(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PAGE_CONTROL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_PAGE_CONTROL, false));
        }
        return this;
    }

    public StreamBuilder matBoolSpinner(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SPINNER));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SPINNER, false));
        }
        return this;
    }

    public StreamBuilder matBoolDetached(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHED));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHED, false));
        }
        return this;
    }

    public StreamBuilder matBoolCustomizable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CUSTOMIZABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CUSTOMIZABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolDetachable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DETACHABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolDockHorizontal(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_HORIZONTAL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_HORIZONTAL, false));
        }
        return this;
    }

    public StreamBuilder matBoolDockVertical(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_VERTICAL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DOCK_VERTICAL, false));
        }
        return this;
    }

    public StreamBuilder matBoolChildrenRemovable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_REMOVABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_REMOVABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolChildrenMovable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_MOVABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILDREN_MOVABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolChildRemovable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_REMOVABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_REMOVABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolChildMovable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_MOVABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_MOVABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolChildLineFeed(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_LINE_FEED));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_CHILD_LINE_FEED, false));
        }
        return this;
    }

    public StreamBuilder matBoolSharedStyle(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SHARED_STYLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SHARED_STYLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolActiveOffline(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_OFFLINE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_OFFLINE, false));
        }
        return this;
    }

    public StreamBuilder matBoolActiveOnline(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_ONLINE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ACTIVE_ONLINE, false));
        }
        return this;
    }

    public StreamBuilder matBoolInactiveForGuest(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INACTIVE_FOR_GUEST));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_INACTIVE_FOR_GUEST, false));
        }
        return this;
    }

    public StreamBuilder matBoolDropdownButton(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DROPDOWN_BUTTON));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DROPDOWN_BUTTON, false));
        }
        return this;
    }

    public StreamBuilder matBoolPopupMenu(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_POPUP_MENU));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_POPUP_MENU, false));
        }
        return this;
    }

    public StreamBuilder matBoolIgnoreUrlList(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL_LIST));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL_LIST, false));
        }
        return this;
    }

    public StreamBuilder matBoolDrawFocus(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DRAW_FOCUS));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DRAW_FOCUS, false));
        }
        return this;
    }

    public StreamBuilder matBoolLoggable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LOGGABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_LOGGABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolHideUrl(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_URL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_URL, false));
        }
        return this;
    }

    public StreamBuilder matBoolAutoCloseable(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_AUTO_CLOSEABLE));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_AUTO_CLOSEABLE, false));
        }
        return this;
    }

    public StreamBuilder matBoolSignoffMenu(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SIGNOFF_MENU));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SIGNOFF_MENU, false));
        }
        return this;
    }

    public StreamBuilder matBoolIgnoreUrl(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IGNORE_URL, false));
        }
        return this;
    }

    public StreamBuilder matBoolSavableToPfc(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SAVABLE_TO_PFC));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_SAVABLE_TO_PFC, false));
        }
        return this;
    }

    public StreamBuilder matBoolStaticUrl(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_STATIC_URL));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_STATIC_URL, false));
        }
        return this;
    }

    public StreamBuilder matBoolAllowTabbing(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ALLOW_TABBING));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_ALLOW_TABBING, false));
        }
        return this;
    }

    public StreamBuilder matBoolDefaultTrigger(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_TRIGGER));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_DEFAULT_TRIGGER, false));
        }
        return this;
    }

    public StreamBuilder matBoolHideTicks(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_TICKS));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_HIDE_TICKS, false));
        }
        return this;
    }

    public StreamBuilder matBoolIsSlider(boolean enabled) {
        if (enabled) {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IS_SLIDER));
        } else {
            frames.add(new DslAtomFrame(MatAtom.BOOL_IS_SLIDER, false));
        }
        return this;
    }

    // ========== UNI Protocol Methods ==========

    /**
     * Start stream (uni_start_stream).
     */
    public StreamBuilder uniStartStream() {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM));
        return this;
    }

    /**
     * Start stream with ID (uni_start_stream).
     */
    public StreamBuilder uniStartStream(String id) {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM, id));
        return this;
    }

    /**
     * End stream (uni_end_stream).
     */
    public StreamBuilder uniEndStream() {
        frames.add(new DslAtomFrame(UniAtom.END_STREAM));
        return this;
    }

    /**
     * End stream with ID (uni_end_stream).
     */
    public StreamBuilder uniEndStream(String id) {
        frames.add(new DslAtomFrame(UniAtom.END_STREAM, id));
        return this;
    }

    /**
     * Abort stream (uni_abort_stream).
     */
    public StreamBuilder uniAbortStream() {
        frames.add(new DslAtomFrame(UniAtom.ABORT_STREAM));
        return this;
    }

    /**
     * Start stream wait on (uni_start_stream_wait_on).
     */
    public StreamBuilder uniStartStreamWaitOn() {
        frames.add(new DslAtomFrame(UniAtom.START_STREAM_WAIT_ON));
        return this;
    }

    /**
     * Wait off end stream (uni_wait_off_end_stream).
     */
    public StreamBuilder uniWaitOffEndStream() {
        frames.add(new DslAtomFrame(UniAtom.WAIT_OFF_END_STREAM));
        return this;
    }

    /**
     * Wait on (uni_wait_on).
     */
    public StreamBuilder uniWaitOn() {
        frames.add(new DslAtomFrame(UniAtom.WAIT_ON));
        return this;
    }

    /**
     * Wait off (uni_wait_off).
     */
    public StreamBuilder uniWaitOff() {
        frames.add(new DslAtomFrame(UniAtom.WAIT_OFF));
        return this;
    }

    /**
     * Wait clear (uni_wait_clear).
     */
    public StreamBuilder uniWaitClear() {
        frames.add(new DslAtomFrame(UniAtom.WAIT_CLEAR));
        return this;
    }

    /**
     * Invoke local (uni_invoke_local).
     */
    public StreamBuilder uniInvokeLocal(FdoGid gid) {
        frames.add(new DslAtomFrame(UniAtom.INVOKE_LOCAL, gid));
        return this;
    }

    /**
     * Invoke no context (uni_invoke_no_context).
     */
    public StreamBuilder uniInvokeNoContext(FdoGid gid) {
        frames.add(new DslAtomFrame(UniAtom.INVOKE_NO_CONTEXT, gid));
        return this;
    }

    /**
     * Invoke local preserve (uni_invoke_local_preserve).
     */
    public StreamBuilder uniInvokeLocalPreserve(FdoGid gid) {
        frames.add(new DslAtomFrame(UniAtom.INVOKE_LOCAL_PRESERVE, gid));
        return this;
    }

    /**
     * Invoke local later (uni_invoke_local_later).
     */
    public StreamBuilder uniInvokeLocalLater(FdoGid gid) {
        frames.add(new DslAtomFrame(UniAtom.INVOKE_LOCAL_LATER, gid));
        return this;
    }

    /**
     * Start loop (uni_start_loop).
     */
    public StreamBuilder uniStartLoop() {
        frames.add(new DslAtomFrame(UniAtom.START_LOOP));
        return this;
    }

    /**
     * End loop (uni_end_loop).
     */
    public StreamBuilder uniEndLoop() {
        frames.add(new DslAtomFrame(UniAtom.END_LOOP));
        return this;
    }

    /**
     * Break (uni_break).
     */
    public StreamBuilder uniBreak() {
        frames.add(new DslAtomFrame(UniAtom.BREAK));
        return this;
    }

    /**
     * Single step (uni_single_step).
     */
    public StreamBuilder uniSingleStep() {
        frames.add(new DslAtomFrame(UniAtom.SINGLE_STEP));
        return this;
    }

    /**
     * Sync skip (uni_sync_skip).
     */
    public StreamBuilder uniSyncSkip(int count) {
        frames.add(new DslAtomFrame(UniAtom.SYNC_SKIP, count));
        return this;
    }

    /**
     * Force processing (uni_force_processing).
     */
    public StreamBuilder uniForceProcessing() {
        frames.add(new DslAtomFrame(UniAtom.FORCE_PROCESSING));
        return this;
    }

    /**
     * Hold (uni_hold).
     */
    public StreamBuilder uniHold() {
        frames.add(new DslAtomFrame(UniAtom.HOLD));
        return this;
    }

    /**
     * Cancel action (uni_cancel_action).
     */
    public StreamBuilder uniCancelAction() {
        frames.add(new DslAtomFrame(UniAtom.CANCEL_ACTION));
        return this;
    }

    /**
     * Use last atom string with atom reference (uni_use_last_atom_string).
     */
    public StreamBuilder uniUseLastAtomString(String atomName) {
        frames.add(new DslAtomFrame(UniAtom.USE_LAST_ATOM_STRING, atomName));
        return this;
    }

    /**
     * Use last atom value with atom reference (uni_use_last_atom_value).
     */
    public StreamBuilder uniUseLastAtomValue(String atomName) {
        frames.add(new DslAtomFrame(UniAtom.USE_LAST_ATOM_VALUE, atomName));
        return this;
    }

    /**
     * Use last atom data (uni_use_last_atom_data).
     */
    public StreamBuilder uniUseLastAtomData() {
        frames.add(new DslAtomFrame(UniAtom.USE_LAST_ATOM_DATA));
        return this;
    }

    /**
     * Convert last atom string (uni_convert_last_atom_string).
     */
    public StreamBuilder uniConvertLastAtomString() {
        frames.add(new DslAtomFrame(UniAtom.CONVERT_LAST_ATOM_STRING));
        return this;
    }

    /**
     * Convert last atom data (uni_convert_last_atom_data).
     */
    public StreamBuilder uniConvertLastAtomData() {
        frames.add(new DslAtomFrame(UniAtom.CONVERT_LAST_ATOM_DATA));
        return this;
    }

    /**
     * Save result (uni_save_result).
     */
    public StreamBuilder uniSaveResult() {
        frames.add(new DslAtomFrame(UniAtom.SAVE_RESULT));
        return this;
    }

    /**
     * Get result (uni_get_result).
     */
    public StreamBuilder uniGetResult() {
        frames.add(new DslAtomFrame(UniAtom.GET_RESULT));
        return this;
    }

    /**
     * Next atom typed (uni_next_atom_typed).
     */
    public StreamBuilder uniNextAtomTyped() {
        frames.add(new DslAtomFrame(UniAtom.NEXT_ATOM_TYPED));
        return this;
    }

    /**
     * Next atom mixed data (uni_next_atom_mixed_data).
     */
    public StreamBuilder uniNextAtomMixedData() {
        frames.add(new DslAtomFrame(UniAtom.NEXT_ATOM_MIXED_DATA));
        return this;
    }

    /**
     * Start typed data (uni_start_typed_data).
     */
    public StreamBuilder uniStartTypedData() {
        frames.add(new DslAtomFrame(UniAtom.START_TYPED_DATA));
        return this;
    }

    /**
     * End typed data (uni_end_typed_data).
     */
    public StreamBuilder uniEndTypedData() {
        frames.add(new DslAtomFrame(UniAtom.END_TYPED_DATA));
        return this;
    }

    /**
     * Start mixed data mode (uni_start_mixed_data_mode).
     */
    public StreamBuilder uniStartMixedDataMode() {
        frames.add(new DslAtomFrame(UniAtom.START_MIXED_DATA_MODE));
        return this;
    }

    /**
     * End mixed data mode (uni_end_mixed_data_mode).
     */
    public StreamBuilder uniEndMixedDataMode() {
        frames.add(new DslAtomFrame(UniAtom.END_MIXED_DATA_MODE));
        return this;
    }

    /**
     * Set data length (uni_set_data_length).
     */
    public StreamBuilder uniSetDataLength(int length) {
        frames.add(new DslAtomFrame(UniAtom.SET_DATA_LENGTH, length));
        return this;
    }

    /**
     * Start large atom (uni_start_large_atom).
     */
    public StreamBuilder uniStartLargeAtom() {
        frames.add(new DslAtomFrame(UniAtom.START_LARGE_ATOM));
        return this;
    }

    /**
     * Large atom segment (uni_large_atom_segment).
     */
    public StreamBuilder uniLargeAtomSegment() {
        frames.add(new DslAtomFrame(UniAtom.LARGE_ATOM_SEGMENT));
        return this;
    }

    /**
     * End large atom (uni_end_large_atom).
     */
    public StreamBuilder uniEndLargeAtom() {
        frames.add(new DslAtomFrame(UniAtom.END_LARGE_ATOM));
        return this;
    }

    /**
     * Change stream ID (uni_change_stream_id).
     */
    public StreamBuilder uniChangeStreamId(int id) {
        frames.add(new DslAtomFrame(UniAtom.CHANGE_STREAM_ID, id));
        return this;
    }

    /**
     * Set command set (uni_set_command_set).
     */
    public StreamBuilder uniSetCommandSet(int set) {
        frames.add(new DslAtomFrame(UniAtom.SET_COMMAND_SET, set));
        return this;
    }

    /**
     * Get current stream ID (uni_get_current_stream_id).
     */
    public StreamBuilder uniGetCurrentStreamId() {
        frames.add(new DslAtomFrame(UniAtom.GET_CURRENT_STREAM_ID));
        return this;
    }

    /**
     * Get first stream (uni_get_first_stream).
     */
    public StreamBuilder uniGetFirstStream() {
        frames.add(new DslAtomFrame(UniAtom.GET_FIRST_STREAM));
        return this;
    }

    /**
     * Get next stream (uni_get_next_stream).
     */
    public StreamBuilder uniGetNextStream() {
        frames.add(new DslAtomFrame(UniAtom.GET_NEXT_STREAM));
        return this;
    }

    /**
     * Get stream window (uni_get_stream_window).
     */
    public StreamBuilder uniGetStreamWindow() {
        frames.add(new DslAtomFrame(UniAtom.GET_STREAM_WINDOW));
        return this;
    }

    /**
     * Get from stream reg (uni_get_from_stream_reg).
     */
    public StreamBuilder uniGetFromStreamReg(int reg) {
        frames.add(new DslAtomFrame(UniAtom.GET_FROM_STREAM_REG, reg));
        return this;
    }

    /**
     * Save to stream reg (uni_save_to_stream_reg).
     */
    public StreamBuilder uniSaveToStreamReg(int reg) {
        frames.add(new DslAtomFrame(UniAtom.SAVE_TO_STREAM_REG, reg));
        return this;
    }

    /**
     * Reset stream regs (uni_reset_stream_regs).
     */
    public StreamBuilder uniResetStreamRegs() {
        frames.add(new DslAtomFrame(UniAtom.RESET_STREAM_REGS));
        return this;
    }

    /**
     * Insert stream (uni_insert_stream).
     */
    public StreamBuilder uniInsertStream(byte[] data) {
        frames.add(new DslAtomFrame(UniAtom.INSERT_STREAM, data));
        return this;
    }

    /**
     * Data (uni_data).
     */
    public StreamBuilder uniData(String data) {
        frames.add(new DslAtomFrame(UniAtom.DATA, data));
        return this;
    }

    /**
     * Void (uni_void).
     */
    public StreamBuilder uniVoid() {
        frames.add(new DslAtomFrame(UniAtom.VOID));
        return this;
    }

    /**
     * Diagnostic message (uni_diagnostic_msg).
     */
    public StreamBuilder uniDiagnosticMsg(String msg) {
        frames.add(new DslAtomFrame(UniAtom.DIAGNOSTIC_MSG, msg));
        return this;
    }

    /**
     * Set watchdog interval (uni_set_watchdog_interval).
     */
    public StreamBuilder uniSetWatchdogInterval(int interval) {
        frames.add(new DslAtomFrame(UniAtom.SET_WATCHDOG_INTERVAL, interval));
        return this;
    }

    /**
     * UDO complete (uni_udo_complete).
     */
    public StreamBuilder uniUdoComplete() {
        frames.add(new DslAtomFrame(UniAtom.UDO_COMPLETE));
        return this;
    }

    /**
     * Test update (uni_test_update).
     */
    public StreamBuilder uniTestUpdate() {
        frames.add(new DslAtomFrame(UniAtom.TEST_UPDATE));
        return this;
    }

    /**
     * Transaction ID (uni_transaction_id).
     */
    public StreamBuilder uniTransactionId(int id) {
        frames.add(new DslAtomFrame(UniAtom.TRANSACTION_ID, id));
        return this;
    }

    /**
     * Result code (uni_result_code).
     */
    public StreamBuilder uniResultCode(int code) {
        frames.add(new DslAtomFrame(UniAtom.RESULT_CODE, code));
        return this;
    }

    /**
     * Command (uni_command).
     */
    public StreamBuilder uniCommand(String cmd) {
        frames.add(new DslAtomFrame(UniAtom.COMMAND, cmd));
        return this;
    }

    /**
     * String to GID (uni_string_to_gid).
     */
    public StreamBuilder uniStringToGid(String str) {
        frames.add(new DslAtomFrame(UniAtom.STRING_TO_GID, str));
        return this;
    }

    // ========== SM Protocol Methods ==========

    /**
     * Send token arg (sm_send_token_arg).
     */
    public StreamBuilder smSendTokenArg(String token) {
        frames.add(new DslAtomFrame(SmAtom.SEND_TOKEN_ARG, token));
        return this;
    }

    /**
     * Send token raw (sm_send_token_raw).
     */
    public StreamBuilder smSendTokenRaw(String token) {
        frames.add(new DslAtomFrame(SmAtom.SEND_TOKEN_RAW, token));
        return this;
    }

    /**
     * M send token arg (sm_m_send_token_arg).
     */
    public StreamBuilder smMSendTokenArg(String token) {
        frames.add(new DslAtomFrame(SmAtom.M_SEND_TOKEN_ARG, token));
        return this;
    }

    /**
     * P send token arg (sm_p_send_token_arg).
     */
    public StreamBuilder smPSendTokenArg(String token) {
        frames.add(new DslAtomFrame(SmAtom.P_SEND_TOKEN_ARG, token));
        return this;
    }

    /**
     * MP send token arg (sm_mp_send_token_arg).
     */
    public StreamBuilder smMpSendTokenArg(String token) {
        frames.add(new DslAtomFrame(SmAtom.MP_SEND_TOKEN_ARG, token));
        return this;
    }

    /**
     * M send token raw (sm_m_send_token_raw).
     */
    public StreamBuilder smMSendTokenRaw(String token) {
        frames.add(new DslAtomFrame(SmAtom.M_SEND_TOKEN_RAW, token));
        return this;
    }

    /**
     * Send window var (sm_send_window_var).
     */
    public StreamBuilder smSendWindowVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.SEND_WINDOW_VAR, var));
        return this;
    }

    /**
     * M send window var (sm_m_send_window_var).
     */
    public StreamBuilder smMSendWindowVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.M_SEND_WINDOW_VAR, var));
        return this;
    }

    /**
     * P send window var (sm_p_send_window_var).
     */
    public StreamBuilder smPSendWindowVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.P_SEND_WINDOW_VAR, var));
        return this;
    }

    /**
     * MP send window var (sm_mp_send_window_var).
     */
    public StreamBuilder smMpSendWindowVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.MP_SEND_WINDOW_VAR, var));
        return this;
    }

    /**
     * Send list var (sm_send_list_var).
     */
    public StreamBuilder smSendListVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.SEND_LIST_VAR, var));
        return this;
    }

    /**
     * M send list var (sm_m_send_list_var).
     */
    public StreamBuilder smMSendListVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.M_SEND_LIST_VAR, var));
        return this;
    }

    /**
     * Send K1 (sm_send_k1).
     */
    public StreamBuilder smSendK1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_K1, target));
        return this;
    }

    /**
     * Send free K1 (sm_send_free_k1).
     */
    public StreamBuilder smSendFreeK1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_FREE_K1, target));
        return this;
    }

    /**
     * Send paid K1 (sm_send_paid_k1).
     */
    public StreamBuilder smSendPaidK1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_PAID_K1, target));
        return this;
    }

    /**
     * Send F1 (sm_send_f1).
     */
    public StreamBuilder smSendF1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_F1, target));
        return this;
    }

    /**
     * Send free F1 (sm_send_free_f1).
     */
    public StreamBuilder smSendFreeF1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_FREE_F1, target));
        return this;
    }

    /**
     * Send paid F1 (sm_send_paid_f1).
     */
    public StreamBuilder smSendPaidF1(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_PAID_F1, target));
        return this;
    }

    /**
     * Send ER (sm_send_er).
     */
    public StreamBuilder smSendEr(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_ER, target));
        return this;
    }

    /**
     * Send MR (sm_send_mr).
     */
    public StreamBuilder smSendMr(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_MR, target));
        return this;
    }

    /**
     * Send MF (sm_send_mf).
     */
    public StreamBuilder smSendMf(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_MF, target));
        return this;
    }

    /**
     * Send BM (sm_send_bm).
     */
    public StreamBuilder smSendBm(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_BM, target));
        return this;
    }

    /**
     * Send BN (sm_send_bn).
     */
    public StreamBuilder smSendBn(FdoGid target) {
        frames.add(new DslAtomFrame(SmAtom.SEND_BN, target));
        return this;
    }

    /**
     * Set domain (sm_set_domain).
     */
    public StreamBuilder smSetDomain(String domain) {
        frames.add(new DslAtomFrame(SmAtom.SET_DOMAIN, domain));
        return this;
    }

    /**
     * Check domain (sm_check_domain).
     */
    public StreamBuilder smCheckDomain(String domain) {
        frames.add(new DslAtomFrame(SmAtom.CHECK_DOMAIN, domain));
        return this;
    }

    /**
     * Set object domain (sm_set_object_domain).
     */
    public StreamBuilder smSetObjectDomain(FdoGid gid) {
        frames.add(new DslAtomFrame(SmAtom.SET_OBJECT_DOMAIN, gid));
        return this;
    }

    /**
     * Set plus group (sm_set_plus_group).
     */
    public StreamBuilder smSetPlusGroup(int group) {
        frames.add(new DslAtomFrame(SmAtom.SET_PLUS_GROUP, group));
        return this;
    }

    /**
     * Check plus group (sm_check_plus_group).
     */
    public StreamBuilder smCheckPlusGroup(int group) {
        frames.add(new DslAtomFrame(SmAtom.CHECK_PLUS_GROUP, group));
        return this;
    }

    /**
     * Enter paid (sm_enter_paid).
     */
    public StreamBuilder smEnterPaid() {
        frames.add(new DslAtomFrame(SmAtom.ENTER_PAID));
        return this;
    }

    /**
     * Enter free (sm_enter_free).
     */
    public StreamBuilder smEnterFree() {
        frames.add(new DslAtomFrame(SmAtom.ENTER_FREE));
        return this;
    }

    /**
     * Do list action (sm_do_list_action).
     */
    public StreamBuilder smDoListAction(int action) {
        frames.add(new DslAtomFrame(SmAtom.DO_LIST_ACTION, action));
        return this;
    }

    /**
     * End object with action (sm_end_object_with_action).
     */
    public StreamBuilder smEndObjectWithAction() {
        frames.add(new DslAtomFrame(SmAtom.END_OBJECT_WITH_ACTION));
        return this;
    }

    /**
     * End object with var (sm_end_object_with_var).
     */
    public StreamBuilder smEndObjectWithVar(String var) {
        frames.add(new DslAtomFrame(SmAtom.END_OBJECT_WITH_VAR, var));
        return this;
    }

    /**
     * IDB get data (sm_idb_get_data).
     */
    public StreamBuilder smIdbGetData(FdoGid gid) {
        frames.add(new DslAtomFrame(SmAtom.IDB_GET_DATA, gid));
        return this;
    }

    /**
     * Send selection code (sm_send_selection_code).
     */
    public StreamBuilder smSendSelectionCode(int code) {
        frames.add(new DslAtomFrame(SmAtom.SEND_SELECTION_CODE, code));
        return this;
    }

    // ========== DE Protocol Methods ==========

    /**
     * Data (de_data).
     */
    public StreamBuilder deData(String data) {
        frames.add(new DslAtomFrame(DeAtom.DATA, data));
        return this;
    }

    /**
     * Start extraction (de_start_extraction).
     */
    public StreamBuilder deStartExtraction() {
        frames.add(new DslAtomFrame(DeAtom.START_EXTRACTION));
        return this;
    }

    /**
     * Start extraction with mode (de_start_extraction).
     */
    public StreamBuilder deStartExtraction(int mode) {
        frames.add(new DslAtomFrame(DeAtom.START_EXTRACTION, mode));
        return this;
    }

    /**
     * End extraction (de_end_extraction).
     */
    public StreamBuilder deEndExtraction() {
        frames.add(new DslAtomFrame(DeAtom.END_EXTRACTION));
        return this;
    }

    /**
     * Set data type (de_set_data_type).
     */
    public StreamBuilder deSetDataType(int type) {
        frames.add(new DslAtomFrame(DeAtom.SET_DATA_TYPE, type));
        return this;
    }

    /**
     * Get data (de_get_data).
     */
    public StreamBuilder deGetData() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA));
        return this;
    }

    /**
     * Get data value (de_get_data_value).
     */
    public StreamBuilder deGetDataValue() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA_VALUE));
        return this;
    }

    /**
     * Get data value with name (de_get_data_value).
     */
    public StreamBuilder deGetDataValue(String name) {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA_VALUE, name));
        return this;
    }

    /**
     * Validate (de_validate).
     */
    public StreamBuilder deValidate(String validation) {
        frames.add(new DslAtomFrame(DeAtom.VALIDATE, validation));
        return this;
    }

    /**
     * Continue extraction (de_start_extraction continuation).
     */
    public StreamBuilder deContinueExtraction() {
        frames.add(new DslAtomFrame(DeAtom.START_EXTRACTION));
        return this;
    }

    /**
     * Get parent (de_get_data for parent).
     */
    public StreamBuilder deGetParent() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA));
        return this;
    }

    /**
     * Get child (de_get_data for child).
     */
    public StreamBuilder deGetChild() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA));
        return this;
    }

    /**
     * Get sibling (de_get_data for sibling).
     */
    public StreamBuilder deGetSibling() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA));
        return this;
    }

    /**
     * Set extraction type (de_set_extraction_type).
     */
    public StreamBuilder deSetExtractionType(int type) {
        frames.add(new DslAtomFrame(DeAtom.SET_EXTRACTION_TYPE, type));
        return this;
    }

    /**
     * Set variable ID (de_set_variable_id).
     */
    public StreamBuilder deSetVariableId(int id) {
        frames.add(new DslAtomFrame(DeAtom.SET_VARIABLE_ID, id));
        return this;
    }

    /**
     * Set text column (de_set_text_column).
     */
    public StreamBuilder deSetTextColumn(int column) {
        frames.add(new DslAtomFrame(DeAtom.SET_TEXT_COLUMN, column));
        return this;
    }

    /**
     * Get data pointer (de_get_data_pointer).
     */
    public StreamBuilder deGetDataPointer() {
        frames.add(new DslAtomFrame(DeAtom.GET_DATA_POINTER));
        return this;
    }

    /**
     * EZ send form (de_ez_send_form).
     */
    public StreamBuilder deEzSendForm(String token) {
        frames.add(new DslAtomFrame(DeAtom.EZ_SEND_FORM, token));
        return this;
    }

    /**
     * Custom data (de_custom_data).
     */
    public StreamBuilder deCustomData(byte[] data) {
        frames.add(new DslAtomFrame(DeAtom.CUSTOM_DATA, data));
        return this;
    }

    /**
     * EZ send list text (de_ez_send_list_text).
     */
    public StreamBuilder deEzSendListText(String token) {
        frames.add(new DslAtomFrame(DeAtom.EZ_SEND_LIST_TEXT, token));
        return this;
    }

    /**
     * EZ send list index (de_ez_send_list_index).
     */
    public StreamBuilder deEzSendListIndex(String token) {
        frames.add(new DslAtomFrame(DeAtom.EZ_SEND_LIST_INDEX, token));
        return this;
    }

    /**
     * EZ send field (de_ez_send_field).
     */
    public StreamBuilder deEzSendField(String token) {
        frames.add(new DslAtomFrame(DeAtom.EZ_SEND_FIELD, token));
        return this;
    }

    /**
     * Typed data (de_typed_data).
     */
    public StreamBuilder deTypedData(int var) {
        frames.add(new DslAtomFrame(DeAtom.TYPED_DATA, var));
        return this;
    }

    // ========== VAR Protocol Methods ==========

    /**
     * Number set (var_number_set).
     */
    public StreamBuilder varNumberSet(String var, int value) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SET, var, value));
        return this;
    }

    /**
     * Number get (var_number_get).
     */
    public StreamBuilder varNumberGet(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_GET, var));
        return this;
    }

    /**
     * Number save (var_number_save).
     */
    public StreamBuilder varNumberSave(String var, int slot) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SAVE, var, slot));
        return this;
    }

    /**
     * Number set from atom (var_number_set_from_atom).
     */
    public StreamBuilder varNumberSetFromAtom(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SET_FROM_ATOM, var));
        return this;
    }

    /**
     * Numa zero (var_numa_zero).
     */
    public StreamBuilder varNumaZero() {
        frames.add(new DslAtomFrame(VarAtom.NUMA_ZERO));
        return this;
    }

    /**
     * Lookup by ID (var_lookup_by_id).
     */
    public StreamBuilder varLookupById(String var, int id) {
        frames.add(new DslAtomFrame(VarAtom.LOOKUP_BY_ID, var, id));
        return this;
    }

    /**
     * String set (var_string_set).
     */
    public StreamBuilder varStringSet(String var, String value) {
        frames.add(new DslAtomFrame(VarAtom.STRING_SET, var, value));
        return this;
    }

    /**
     * String get (var_string_get).
     */
    public StreamBuilder varStringGet(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_GET, var));
        return this;
    }

    /**
     * String null (var_string_null).
     */
    public StreamBuilder varStringNull(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_NULL, var));
        return this;
    }

    /**
     * String save (var_string_save).
     */
    public StreamBuilder varStringSave(String var, int slot) {
        frames.add(new DslAtomFrame(VarAtom.STRING_SAVE, var, slot));
        return this;
    }

    /**
     * String set from atom (var_string_set_from_atom).
     */
    public StreamBuilder varStringSetFromAtom(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_SET_FROM_ATOM, var));
        return this;
    }

    /**
     * Data set (var_data_set).
     */
    public StreamBuilder varDataSet(String var, byte[] data) {
        frames.add(new DslAtomFrame(VarAtom.DATA_SET, var, data));
        return this;
    }

    /**
     * Data zero (var_data_zero).
     */
    public StreamBuilder varDataZero(String var) {
        frames.add(new DslAtomFrame(VarAtom.DATA_ZERO, var));
        return this;
    }

    /**
     * Data save (var_data_save).
     */
    public StreamBuilder varDataSave(String var, int slot) {
        frames.add(new DslAtomFrame(VarAtom.DATA_SAVE, var, slot));
        return this;
    }

    /**
     * Data set from atom (var_data_set_from_atom).
     */
    public StreamBuilder varDataSetFromAtom(String var) {
        frames.add(new DslAtomFrame(VarAtom.DATA_SET_FROM_ATOM, var));
        return this;
    }

    /**
     * Data get (var_data_get).
     */
    public StreamBuilder varDataGet(String var) {
        frames.add(new DslAtomFrame(VarAtom.DATA_GET, var));
        return this;
    }

    /**
     * Numa ones (var_numa_ones).
     */
    public StreamBuilder varNumaOnes() {
        frames.add(new DslAtomFrame(VarAtom.NUMA_ONES));
        return this;
    }

    /**
     * Numa increment (var_numa_increment).
     */
    public StreamBuilder varNumaIncrement() {
        frames.add(new DslAtomFrame(VarAtom.NUMA_INCREMENT));
        return this;
    }

    /**
     * Numa decrement (var_numa_decrement).
     */
    public StreamBuilder varNumaDecrement() {
        frames.add(new DslAtomFrame(VarAtom.NUMA_DECREMENT));
        return this;
    }

    /**
     * Number increment (var_number_increment).
     */
    public StreamBuilder varNumberIncrement(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_INCREMENT, var));
        return this;
    }

    /**
     * Number decrement (var_number_decrement).
     */
    public StreamBuilder varNumberDecrement(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_DECREMENT, var));
        return this;
    }

    /**
     * Number zero (var_number_zero).
     */
    public StreamBuilder varNumberZero(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_ZERO, var));
        return this;
    }

    /**
     * Number ones (var_number_ones).
     */
    public StreamBuilder varNumberOnes(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_ONES, var));
        return this;
    }

    /**
     * Number add (var_number_add).
     */
    public StreamBuilder varNumberAdd(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_ADD, varA, varB));
        return this;
    }

    /**
     * Number sub (var_number_sub).
     */
    public StreamBuilder varNumberSub(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SUB, varA, varB));
        return this;
    }

    /**
     * Number mul (var_number_mul).
     */
    public StreamBuilder varNumberMul(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_MUL, varA, varB));
        return this;
    }

    /**
     * Number div (var_number_div).
     */
    public StreamBuilder varNumberDiv(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_DIV, varA, varB));
        return this;
    }

    /**
     * Number anding (var_number_anding).
     */
    public StreamBuilder varNumberAnding(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_ANDING, varA, varB));
        return this;
    }

    /**
     * Number oring (var_number_oring).
     */
    public StreamBuilder varNumberOring(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_ORING, varA, varB));
        return this;
    }

    /**
     * Number SHL (var_number_shl).
     */
    public StreamBuilder varNumberShl(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SHL, varA, varB));
        return this;
    }

    /**
     * Number SHR (var_number_shr).
     */
    public StreamBuilder varNumberShr(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SHR, varA, varB));
        return this;
    }

    /**
     * Number copy between regs (var_number_copy_between_regs).
     */
    public StreamBuilder varNumberCopyBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_COPY_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * Number swap between regs (var_number_swap_between_regs).
     */
    public StreamBuilder varNumberSwapBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_SWAP_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * Number clear ID (var_number_clear_id).
     */
    public StreamBuilder varNumberClearId(String var) {
        frames.add(new DslAtomFrame(VarAtom.NUMBER_CLEAR_ID, var));
        return this;
    }

    /**
     * String copy STRA to STRB (var_string_copy_stra_to_strb).
     */
    public StreamBuilder varStringCopyStraToStrb(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.STRING_COPY_STRA_TO_STRB, varA, varB));
        return this;
    }

    /**
     * String copy STRB to STRA (var_string_copy_strb_to_stra).
     */
    public StreamBuilder varStringCopyStrbToStra(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.STRING_COPY_STRB_TO_STRA, varA, varB));
        return this;
    }

    /**
     * String copy between regs (var_string_copy_between_regs).
     */
    public StreamBuilder varStringCopyBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.STRING_COPY_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * String swap between regs (var_string_swap_between_regs).
     */
    public StreamBuilder varStringSwapBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.STRING_SWAP_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * String clear ID (var_string_clear_id).
     */
    public StreamBuilder varStringClearId(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_CLEAR_ID, var));
        return this;
    }

    /**
     * String trim spaces (var_string_trim_spaces).
     */
    public StreamBuilder varStringTrimSpaces(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_TRIM_SPACES, var));
        return this;
    }

    /**
     * String trim spaces safely (var_string_trim_spaces_safely).
     */
    public StreamBuilder varStringTrimSpacesSafely(String var) {
        frames.add(new DslAtomFrame(VarAtom.STRING_TRIM_SPACES_SAFELY, var));
        return this;
    }

    /**
     * Data copy DATA to DATB (var_data_copy_data_to_datb).
     */
    public StreamBuilder varDataCopyDataToDatb(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.DATA_COPY_DATA_TO_DATB, varA, varB));
        return this;
    }

    /**
     * Data copy DATB to DATA (var_data_copy_datb_to_data).
     */
    public StreamBuilder varDataCopyDatbToData(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.DATA_COPY_DATB_TO_DATA, varA, varB));
        return this;
    }

    /**
     * Data copy between regs (var_data_copy_between_regs).
     */
    public StreamBuilder varDataCopyBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.DATA_COPY_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * Data swap between regs (var_data_swap_between_regs).
     */
    public StreamBuilder varDataSwapBetweenRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.DATA_SWAP_BETWEEN_REGS, varA, varB));
        return this;
    }

    /**
     * Data clear ID (var_data_clear_id).
     */
    public StreamBuilder varDataClearId(String var) {
        frames.add(new DslAtomFrame(VarAtom.DATA_CLEAR_ID, var));
        return this;
    }

    /**
     * Reset (var_reset).
     */
    public StreamBuilder varReset() {
        frames.add(new DslAtomFrame(VarAtom.RESET));
        return this;
    }

    /**
     * Random number (var_random_number).
     */
    public StreamBuilder varRandomNumber(String var) {
        frames.add(new DslAtomFrame(VarAtom.RANDOM_NUMBER, var));
        return this;
    }

    /**
     * String concatenate regs (var_string_concatenate_regs).
     */
    public StreamBuilder varStringConcatenateRegs(String varA, String varB) {
        frames.add(new DslAtomFrame(VarAtom.STRING_CONCATENATE_REGS, varA, varB));
        return this;
    }

    /**
     * Check string type and convert (var_check_string_type_and_convert).
     */
    public StreamBuilder varCheckStringTypeAndConvert(String var) {
        frames.add(new DslAtomFrame(VarAtom.CHECK_STRING_TYPE_AND_CONVERT, var));
        return this;
    }

    /**
     * Get string convert len (var_get_string_convert_len).
     */
    public StreamBuilder varGetStringConvertLen(String var) {
        frames.add(new DslAtomFrame(VarAtom.GET_STRING_CONVERT_LEN, var));
        return this;
    }

    // ========== IF Protocol Methods ==========

    /**
     * Last return true then (if_last_return_true_then).
     */
    public StreamBuilder ifLastReturnTrueThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.LAST_RETURN_TRUE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa eq numb then (if_numa_eq_numb_then).
     */
    public StreamBuilder ifNumaEqNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_EQ_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa lt numb then (if_numa_lt_numb_then).
     */
    public StreamBuilder ifNumaLtNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_LT_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa gt numb then (if_numa_gt_numb_then).
     */
    public StreamBuilder ifNumaGtNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_GT_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Stra eq strb then (if_stra_eq_strb_then).
     */
    public StreamBuilder ifStrAEqStrBThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRA_EQ_STRB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Stra neq strb then (if_stra_neq_strb_then).
     */
    public StreamBuilder ifStrANeqStrBThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRA_NEQ_STRB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa neq numb then (if_numa_neq_numb_then).
     */
    public StreamBuilder ifNumaNeqNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_NEQ_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa gte numb then (if_numa_gte_numb_then).
     */
    public StreamBuilder ifNumaGteNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_GTE_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa lte numb then (if_numa_lte_numb_then).
     */
    public StreamBuilder ifNumaLteNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_LTE_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa and numb then (if_numa_and_numb_then).
     */
    public StreamBuilder ifNumaAndNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_AND_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa or numb then (if_numa_or_numb_then).
     */
    public StreamBuilder ifNumaOrNumbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_OR_NUMB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa true then (if_numa_true_then).
     */
    public StreamBuilder ifNumaTrueThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_TRUE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa false then (if_numa_false_then).
     */
    public StreamBuilder ifNumaFalseThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_FALSE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numb true then (if_numb_true_then).
     */
    public StreamBuilder ifNumbTrueThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMB_TRUE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numb false then (if_numb_false_then).
     */
    public StreamBuilder ifNumbFalseThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMB_FALSE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Stra eq null then (if_stra_eq_null_then).
     */
    public StreamBuilder ifStrAEqNullThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRA_EQ_NULL_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Strb eq null then (if_strb_eq_null_then).
     */
    public StreamBuilder ifStrBEqNullThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRB_EQ_NULL_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Stra neq null then (if_stra_neq_null_then).
     */
    public StreamBuilder ifStrANeqNullThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRA_NEQ_NULL_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Strb neq null then (if_strb_neq_null_then).
     */
    public StreamBuilder ifStrBNeqNullThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRB_NEQ_NULL_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Data eq zero then (if_data_eq_zero_then).
     */
    public StreamBuilder ifDataEqZeroThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATA_EQ_ZERO_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Datb eq zero then (if_datb_eq_zero_then).
     */
    public StreamBuilder ifDatbEqZeroThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATB_EQ_ZERO_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Data neq zero then (if_data_neq_zero_then).
     */
    public StreamBuilder ifDataNeqZeroThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATA_NEQ_ZERO_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Datb neq zero then (if_datb_neq_zero_then).
     */
    public StreamBuilder ifDatbNeqZeroThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATB_NEQ_ZERO_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Data eq datb then (if_data_eq_datb_then).
     */
    public StreamBuilder ifDataEqDatbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATA_EQ_DATB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Data neq datb then (if_data_neq_datb_then).
     */
    public StreamBuilder ifDataNeqDatbThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATA_NEQ_DATB_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Last return false then (if_last_return_false_then).
     */
    public StreamBuilder ifLastReturnFalseThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.LAST_RETURN_FALSE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Last return true exit (if_last_return_true_exit).
     */
    public StreamBuilder ifLastReturnTrueExit() {
        frames.add(new DslAtomFrame(IfAtom.LAST_RETURN_TRUE_EXIT));
        return this;
    }

    /**
     * Last return false exit (if_last_return_false_exit).
     */
    public StreamBuilder ifLastReturnFalseExit() {
        frames.add(new DslAtomFrame(IfAtom.LAST_RETURN_FALSE_EXIT));
        return this;
    }

    /**
     * Free area then (if_free_area_then).
     */
    public StreamBuilder ifFreeAreaThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.FREE_AREA_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Paid area then (if_paid_area_then).
     */
    public StreamBuilder ifPaidAreaThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.PAID_AREA_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Test index true then (if_test_index_true_then).
     */
    public StreamBuilder ifTestIndexTrueThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.TEST_INDEX_TRUE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Test index false then (if_test_index_false_then).
     */
    public StreamBuilder ifTestIndexFalseThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.TEST_INDEX_FALSE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Stra in strb prefix then (if_stra_in_strb_prefix_then).
     */
    public StreamBuilder ifStraInStrbPrefixThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRA_IN_STRB_PREFIX_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Strb in stra prefix then (if_strb_in_stra_prefix_then).
     */
    public StreamBuilder ifStrbInStraPrefixThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.STRB_IN_STRA_PREFIX_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Data in datb prefix then (if_data_in_datb_prefix_then).
     */
    public StreamBuilder ifDataInDatbPrefixThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATA_IN_DATB_PREFIX_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Datb in data prefix then (if_datb_in_data_prefix_then).
     */
    public StreamBuilder ifDatbInDataPrefixThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DATB_IN_DATA_PREFIX_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Online then (if_online_then).
     */
    public StreamBuilder ifOnlineThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.ONLINE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Offline then (if_offline_then).
     */
    public StreamBuilder ifOfflineThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.OFFLINE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Guest then (if_guest_then).
     */
    public StreamBuilder ifGuestThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.GUEST_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Owner then (if_owner_then).
     */
    public StreamBuilder ifOwnerThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.OWNER_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Newuser then (if_newuser_then).
     */
    public StreamBuilder ifNewuserThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NEWUSER_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * AM then (if_am_then).
     */
    public StreamBuilder ifAmThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.AM_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * PM then (if_pm_then).
     */
    public StreamBuilder ifPmThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.PM_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Debug true then (if_debug_true_then).
     */
    public StreamBuilder ifDebugTrueThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DEBUG_TRUE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Debug false then (if_debug_false_then).
     */
    public StreamBuilder ifDebugFalseThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.DEBUG_FALSE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa eq one then (if_numa_eq_one_then).
     */
    public StreamBuilder ifNumaEqOneThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_EQ_ONE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numa gt one then (if_numa_gt_one_then).
     */
    public StreamBuilder ifNumaGtOneThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMA_GT_ONE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numb eq one then (if_numb_eq_one_then).
     */
    public StreamBuilder ifNumbEqOneThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMB_EQ_ONE_THEN, trueBranch, falseBranch));
        return this;
    }

    /**
     * Numb gt one then (if_numb_gt_one_then).
     */
    public StreamBuilder ifNumbGtOneThen(int trueBranch, int falseBranch) {
        frames.add(new DslAtomFrame(IfAtom.NUMB_GT_ONE_THEN, trueBranch, falseBranch));
        return this;
    }

    // ========== ACT Protocol Methods ==========

    /**
     * Set criterion with int (act_set_criterion).
     */
    public StreamBuilder actSetCriterion(int criterion) {
        frames.add(new DslAtomFrame(ActAtom.SET_CRITERION, criterion));
        return this;
    }

    /**
     * Do action with string (act_do_action).
     */
    public StreamBuilder actDoAction(String criterion) {
        frames.add(new DslAtomFrame(ActAtom.DO_ACTION, criterion));
        return this;
    }

    /**
     * Replace action with nested stream (act_replace_action).
     */
    public StreamBuilder actReplaceAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Replace select action with nested stream (act_replace_select_action).
     */
    public StreamBuilder actReplaceSelectAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_SELECT_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Set inheritance (act_set_inheritance).
     */
    public StreamBuilder actSetInheritance(int inheritance) {
        frames.add(new DslAtomFrame(ActAtom.SET_INHERITANCE, inheritance));
        return this;
    }

    /**
     * Sound beep (act_sound_beep).
     */
    public StreamBuilder actSoundBeep() {
        frames.add(new DslAtomFrame(ActAtom.SOUND_BEEP));
        return this;
    }

    /**
     * Modify action (act_modify_action).
     */
    public StreamBuilder actModifyAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.MODIFY_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Set test index (act_set_test_index).
     */
    public StreamBuilder actSetTestIndex(int index) {
        frames.add(new DslAtomFrame(ActAtom.SET_TEST_INDEX, index));
        return this;
    }

    /**
     * Clear test index (act_clr_test_index).
     */
    public StreamBuilder actClrTestIndex() {
        frames.add(new DslAtomFrame(ActAtom.CLR_TEST_INDEX));
        return this;
    }

    /**
     * Set index (act_set_index).
     */
    public StreamBuilder actSetIndex(int index) {
        frames.add(new DslAtomFrame(ActAtom.SET_INDEX, index));
        return this;
    }

    /**
     * Append action (act_append_action).
     */
    public StreamBuilder actAppendAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.APPEND_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Prepend action (act_prepend_action).
     */
    public StreamBuilder actPrependAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.PREPEND_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Change action (act_change_action).
     */
    public StreamBuilder actChangeAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.CHANGE_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Append select action (act_append_select_action).
     */
    public StreamBuilder actAppendSelectAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.APPEND_SELECT_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Prepend select action (act_prepend_select_action).
     */
    public StreamBuilder actPrependSelectAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.PREPEND_SELECT_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Change select action (act_change_select_action).
     */
    public StreamBuilder actChangeSelectAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.CHANGE_SELECT_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    /**
     * Copy action to reg (act_copy_action_to_reg).
     */
    public StreamBuilder actCopyActionToReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.COPY_ACTION_TO_REG, reg));
        return this;
    }

    /**
     * Replace action from reg (act_replace_action_from_reg).
     */
    public StreamBuilder actReplaceActionFromReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.REPLACE_ACTION_FROM_REG, reg));
        return this;
    }

    /**
     * Append action from reg (act_append_action_from_reg).
     */
    public StreamBuilder actAppendActionFromReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.APPEND_ACTION_FROM_REG, reg));
        return this;
    }

    /**
     * Prepend action from reg (act_prepend_action_from_reg).
     */
    public StreamBuilder actPrependActionFromReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.PREPEND_ACTION_FROM_REG, reg));
        return this;
    }

    /**
     * Change action from reg (act_change_action_from_reg).
     */
    public StreamBuilder actChangeActionFromReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.CHANGE_ACTION_FROM_REG, reg));
        return this;
    }

    /**
     * Set action in reg (act_set_action_in_reg).
     */
    public StreamBuilder actSetActionInReg(int reg) {
        frames.add(new DslAtomFrame(ActAtom.SET_ACTION_IN_REG, reg));
        return this;
    }

    /**
     * Interpret packet (act_interpret_packet).
     */
    public StreamBuilder actInterpretPacket(byte[] packet) {
        frames.add(new DslAtomFrame(ActAtom.INTERPRET_PACKET, packet));
        return this;
    }

    /**
     * Set DB length (act_set_db_length).
     */
    public StreamBuilder actSetDbLength(int length) {
        frames.add(new DslAtomFrame(ActAtom.SET_DB_LENGTH, length));
        return this;
    }

    /**
     * Get DB record (act_get_db_record).
     */
    public StreamBuilder actGetDbRecord() {
        frames.add(new DslAtomFrame(ActAtom.GET_DB_RECORD));
        return this;
    }

    /**
     * Set DB ID (act_set_db_id).
     */
    public StreamBuilder actSetDbId(int id) {
        frames.add(new DslAtomFrame(ActAtom.SET_DB_ID, id));
        return this;
    }

    /**
     * Set DB record (act_set_db_record).
     */
    public StreamBuilder actSetDbRecord(byte[] record) {
        frames.add(new DslAtomFrame(ActAtom.SET_DB_RECORD, record));
        return this;
    }

    /**
     * Set guest flag (act_set_guest_flag).
     */
    public StreamBuilder actSetGuestFlag(int flag) {
        frames.add(new DslAtomFrame(ActAtom.SET_GUEST_FLAG, flag));
        return this;
    }

    /**
     * Set newuser flag (act_set_newuser_flag).
     */
    public StreamBuilder actSetNewuserFlag(int flag) {
        frames.add(new DslAtomFrame(ActAtom.SET_NEWUSER_FLAG, flag));
        return this;
    }

    /**
     * Set DB offset (act_set_db_offset).
     */
    public StreamBuilder actSetDbOffset(int offset) {
        frames.add(new DslAtomFrame(ActAtom.SET_DB_OFFSET, offset));
        return this;
    }

    /**
     * Get DB value (act_get_db_value).
     */
    public StreamBuilder actGetDbValue() {
        frames.add(new DslAtomFrame(ActAtom.GET_DB_VALUE));
        return this;
    }

    /**
     * Format quote (act_format_quote).
     */
    public StreamBuilder actFormatQuote(String quote) {
        frames.add(new DslAtomFrame(ActAtom.FORMAT_QUOTE, quote));
        return this;
    }

    /**
     * Replace popup menu action (act_replace_popup_menu_action).
     */
    public StreamBuilder actReplacePopupMenuAction(Consumer<StreamBuilder> actionBuilder) {
        StreamBuilder actionStream = new StreamBuilder(this);
        actionBuilder.accept(actionStream);
        DslAtomFrame actionFrame = new DslAtomFrame(ActAtom.REPLACE_POPUP_MENU_ACTION);
        actionFrame.withNestedStream(actionStream.frames);
        frames.add(actionFrame);
        return this;
    }

    // ========== BUF Protocol Methods ==========

    /**
     * Clear buffer (buf_clear_buffer).
     */
    public StreamBuilder bufClearBuffer() {
        frames.add(new DslAtomFrame(BufAtom.CLEAR_BUFFER));
        return this;
    }

    /**
     * Close buffer (buf_close_buffer).
     */
    public StreamBuilder bufCloseBuffer() {
        frames.add(new DslAtomFrame(BufAtom.CLOSE_BUFFER));
        return this;
    }

    /**
     * Set token (buf_set_token).
     */
    public StreamBuilder bufSetToken(String token) {
        frames.add(new DslAtomFrame(BufAtom.SET_TOKEN, token));
        return this;
    }

    /**
     * Append token (buf_add_token).
     */
    public StreamBuilder bufAppendToken(String token) {
        frames.add(new DslAtomFrame(BufAtom.ADD_TOKEN, token));
        return this;
    }

    /**
     * Start buffer (buf_start_buffer).
     */
    public StreamBuilder bufStartBuffer(int flags) {
        frames.add(new DslAtomFrame(BufAtom.START_BUFFER, flags));
        return this;
    }

    /**
     * Add atom pointer (buf_add_atom_pointer).
     */
    public StreamBuilder bufAddAtomPointer(String pointer) {
        frames.add(new DslAtomFrame(BufAtom.ADD_ATOM_POINTER, pointer));
        return this;
    }

    /**
     * Add atom data (buf_add_atom_data).
     */
    public StreamBuilder bufAddAtomData(int data) {
        frames.add(new DslAtomFrame(BufAtom.ADD_ATOM_DATA, data));
        return this;
    }

    /**
     * Add pointer (buf_add_pointer).
     */
    public StreamBuilder bufAddPointer(String pointer) {
        frames.add(new DslAtomFrame(BufAtom.ADD_POINTER, pointer));
        return this;
    }

    /**
     * Add data (buf_add_data).
     */
    public StreamBuilder bufAddData(int data) {
        frames.add(new DslAtomFrame(BufAtom.ADD_DATA, data));
        return this;
    }

    /**
     * Add data (buf_add_data) with byte array.
     */
    public StreamBuilder bufAddData(byte[] data) {
        frames.add(new DslAtomFrame(BufAtom.ADD_DATA, data));
        return this;
    }

    /**
     * Use buffer (buf_use_buffer).
     */
    public StreamBuilder bufUseBuffer(int flags) {
        frames.add(new DslAtomFrame(BufAtom.USE_BUFFER, flags));
        return this;
    }

    /**
     * Set flags (buf_set_flags).
     */
    public StreamBuilder bufSetFlags(int flags) {
        frames.add(new DslAtomFrame(BufAtom.SET_FLAGS, flags));
        return this;
    }

    /**
     * Save buffer to DB (buf_save_buffer_to_db).
     */
    public StreamBuilder bufSaveBufferToDb() {
        frames.add(new DslAtomFrame(BufAtom.SAVE_BUFFER_TO_DB));
        return this;
    }

    /**
     * Load buffer from DB (buf_load_buffer_from_db).
     */
    public StreamBuilder bufLoadBufferFromDb() {
        frames.add(new DslAtomFrame(BufAtom.LOAD_BUFFER_FROM_DB));
        return this;
    }

    /**
     * Send buffer to host (buf_send_buffer_to_host).
     */
    public StreamBuilder bufSendBufferToHost() {
        frames.add(new DslAtomFrame(BufAtom.SEND_BUFFER_TO_HOST));
        return this;
    }

    // ========== IDB Protocol Methods ==========

    /**
     * Get data (idb_get_data).
     */
    public StreamBuilder idbGetData(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.GET_DATA, gid));
        return this;
    }

    /**
     * Set data (idb_data).
     */
    public StreamBuilder idbSetData(FdoGid gid, byte[] data) {
        frames.add(new DslAtomFrame(IdbAtom.DATA, gid, data));
        return this;
    }

    /**
     * Start object (idb_start_obj).
     */
    public StreamBuilder idbStartObj(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.START_OBJ, gid));
        return this;
    }

    /**
     * End object (idb_end_obj).
     */
    public StreamBuilder idbEndObj() {
        frames.add(new DslAtomFrame(IdbAtom.END_OBJ));
        return this;
    }

    /**
     * Delete object (idb_delete_obj).
     */
    public StreamBuilder idbDeleteObj(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.DELETE_OBJ, gid));
        return this;
    }

    /**
     * Close object (idb_close_obj).
     */
    public StreamBuilder idbCloseObj() {
        frames.add(new DslAtomFrame(IdbAtom.CLOSE_OBJ));
        return this;
    }

    /**
     * Exists (idb_exists).
     */
    public StreamBuilder idbExists(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.EXISTS, gid));
        return this;
    }

    /**
     * Start extraction (idb_start_extraction).
     */
    public StreamBuilder idbStartExtraction(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.START_EXTRACTION, gid));
        return this;
    }

    /**
     * End extraction (idb_end_extraction).
     */
    public StreamBuilder idbEndExtraction() {
        frames.add(new DslAtomFrame(IdbAtom.END_EXTRACTION));
        return this;
    }

    /**
     * Get value (idb_get_value).
     */
    public StreamBuilder idbGetValue(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.GET_VALUE, gid));
        return this;
    }

    /**
     * Append data (idb_append_data).
     */
    public StreamBuilder idbAppendData(FdoGid gid, byte[] data) {
        frames.add(new DslAtomFrame(IdbAtom.APPEND_DATA, gid, data));
        return this;
    }

    /**
     * Change context (idb_change_context).
     */
    public StreamBuilder idbChangeContext(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.CHANGE_CONTEXT, gid));
        return this;
    }

    /**
     * End context (idb_end_context).
     */
    public StreamBuilder idbEndContext() {
        frames.add(new DslAtomFrame(IdbAtom.END_CONTEXT));
        return this;
    }

    /**
     * Reset (idb_reset).
     */
    public StreamBuilder idbReset() {
        frames.add(new DslAtomFrame(IdbAtom.RESET));
        return this;
    }

    /**
     * Get string (idb_get_string).
     */
    public StreamBuilder idbGetString(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.GET_STRING, gid));
        return this;
    }

    /**
     * Cancel (idb_cancel).
     */
    public StreamBuilder idbCancel() {
        frames.add(new DslAtomFrame(IdbAtom.CANCEL));
        return this;
    }

    /**
     * Set context (idb_set_context).
     */
    public StreamBuilder idbSetContext(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.SET_CONTEXT, gid));
        return this;
    }

    /**
     * ATR DOD (idb_atr_dod).
     */
    public StreamBuilder idbAtrDod(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_DOD, gid));
        return this;
    }

    /**
     * ATR global ID (idb_atr_globalid).
     */
    public StreamBuilder idbAtrGlobalId(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_GLOBALID, gid));
        return this;
    }

    /**
     * ATR length (idb_atr_length).
     */
    public StreamBuilder idbAtrLength(int length) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_LENGTH, length));
        return this;
    }

    /**
     * ATR stamp (idb_atr_stamp).
     */
    public StreamBuilder idbAtrStamp(int stamp) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_STAMP, stamp));
        return this;
    }

    /**
     * ATR offset (idb_atr_offset).
     */
    public StreamBuilder idbAtrOffset(int offset) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_OFFSET, offset));
        return this;
    }

    /**
     * ATR type (idb_atr_type).
     */
    public StreamBuilder idbAtrType(int type) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_TYPE, type));
        return this;
    }

    /**
     * ATR compressed (idb_atr_compressed).
     */
    public StreamBuilder idbAtrCompressed(int compressed) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_COMPRESSED, compressed));
        return this;
    }

    /**
     * ATR encrypted (idb_atr_encrypted).
     */
    public StreamBuilder idbAtrEncrypted(int encrypted) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_ENCRYPTED, encrypted));
        return this;
    }

    /**
     * ATR expiration (idb_atr_expiration).
     */
    public StreamBuilder idbAtrExpiration(int expiration) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_EXPIRATION, expiration));
        return this;
    }

    /**
     * ATR compress (idb_atr_compress).
     */
    public StreamBuilder idbAtrCompress(int compress) {
        frames.add(new DslAtomFrame(IdbAtom.ATR_COMPRESS, compress));
        return this;
    }

    /**
     * Use default icon (idb_use_default_icon).
     */
    public StreamBuilder idbUseDefaultIcon() {
        frames.add(new DslAtomFrame(IdbAtom.USE_DEFAULT_ICON));
        return this;
    }

    /**
     * Get length (idb_get_length).
     */
    public StreamBuilder idbGetLength(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.GET_LENGTH, gid));
        return this;
    }

    /**
     * DOD progress gauge (idb_dod_progress_gauge).
     */
    public StreamBuilder idbDodProgressGauge(int gauge) {
        frames.add(new DslAtomFrame(IdbAtom.DOD_PROGRESS_GAUGE, gauge));
        return this;
    }

    /**
     * Get data null terminated (idb_get_data_null_terminated).
     */
    public StreamBuilder idbGetDataNullTerminated(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.GET_DATA_NULL_TERMINATED, gid));
        return this;
    }

    /**
     * Check and set FTV (idb_check_and_set_ftv).
     */
    public StreamBuilder idbCheckAndSetFtv(FdoGid gid) {
        frames.add(new DslAtomFrame(IdbAtom.CHECK_AND_SET_FTV, gid));
        return this;
    }

    /**
     * Clear FTV (idb_clear_ftv).
     */
    public StreamBuilder idbClearFtv() {
        frames.add(new DslAtomFrame(IdbAtom.CLEAR_FTV));
        return this;
    }

    /**
     * DOD failed (idb_dod_failed).
     */
    public StreamBuilder idbDodFailed() {
        frames.add(new DslAtomFrame(IdbAtom.DOD_FAILED));
        return this;
    }

    // ========== Build and compile ==========

    /**
     * Get the list of frames built so far.
     *
     * @return Unmodifiable list of frames
     */
    public List<DslAtomFrame> frames() {
        return List.copyOf(frames);
    }

    /**
     * Compile this stream to binary format.
     *
     * This method converts the DSL frames to FDO text source, then delegates
     * to the proven FdoCompiler for binary encoding. This ensures byte-for-byte
     * compatibility with the text compiler path.
     *
     * @return The compiled binary data
     * @throws FdoException if compilation fails
     */
    public byte[] compile() throws FdoException {
        String source = DslTextEmitter.emit(frames);
        return FdoCompiler.create().compile(source);
    }

    /**
     * Get the FDO text source representation of this stream.
     *
     * Useful for debugging - you can see exactly what text will be compiled.
     *
     * @return FDO text source
     */
    public String toSource() {
        return DslTextEmitter.emit(frames);
    }

    /**
     * Get the parent builder (for nested streams).
     *
     * @return The parent builder, or null if this is the root
     */
    public StreamBuilder parent() {
        return parent;
    }

    /**
     * Return to the parent builder.
     *
     * @return The parent builder
     * @throws IllegalStateException if this is the root builder
     */
    public StreamBuilder end() {
        if (parent == null) {
            throw new IllegalStateException("Cannot end root stream builder");
        }
        return parent;
    }
}
